<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Olympiad - Sports Management System</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: #f8f9fa; }
    
    .login-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
    .login-card { background: white; border-radius: 16px; padding: 40px; width: 100%; max-width: 400px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
    .login-header { text-align: center; margin-bottom: 30px; }
    .logo { font-size: 48px; margin-bottom: 10px; }
    .login-header h1 { font-size: 28px; color: #1a1a2e; margin-bottom: 5px; }
    .login-header p { color: #666; font-size: 14px; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; color: #333; font-weight: 500; font-size: 14px; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #4361ee; }
    .btn { width: 100%; padding: 14px; background: #4361ee; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
    .btn:hover { background: #3651d4; }
    .btn-secondary { background: #e0e0e0; color: #333; }
    .btn-secondary:hover { background: #d0d0d0; }
    .btn-small { padding: 8px 16px; font-size: 13px; width: auto; }
    .btn-danger { background: #dc2626; }
    .btn-danger:hover { background: #b91c1c; }
    .error { background: #fee2e2; color: #dc2626; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
    
    .app-layout { display: flex; min-height: 100vh; }
    .sidebar { width: 250px; background: #1a1a2e; color: white; position: fixed; height: 100vh; overflow-y: auto; }
    .sidebar-header { padding: 20px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); position: sticky; top: 0; background: #1a1a2e; z-index: 10; }
    .sidebar-header .logo { font-size: 28px; margin: 0; }
    .sidebar-header h1 { font-size: 20px; font-weight: 700; }
    .nav { padding: 10px 0; }
    .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: rgba(255,255,255,0.7); cursor: pointer; transition: all 0.2s; border-left: 3px solid transparent; }
    .nav-item:hover { background: rgba(255,255,255,0.05); color: white; }
    .nav-item.active { background: rgba(67,97,238,0.2); color: white; border-left-color: #4361ee; }
    .nav-icon { font-size: 18px; }
    .nav-label { font-size: 14px; font-weight: 500; }
    .sidebar-footer { padding: 20px; border-top: 1px solid rgba(255,255,255,0.1); position: sticky; bottom: 0; background: #1a1a2e; }
    .user-info { margin-bottom: 12px; }
    .user-role { font-size: 11px; background: #4361ee; padding: 2px 8px; border-radius: 10px; }
    .user-name { display: block; font-size: 14px; font-weight: 500; margin-top: 4px; }
    .logout-btn { width: 100%; padding: 10px; background: rgba(255,255,255,0.1); color: white; border: none; border-radius: 6px; cursor: pointer; }
    
    .main-content { flex: 1; margin-left: 250px; background: #f8f9fa; min-height: 100vh; padding: 24px; max-width: 100%; }
    
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px; }
    .page-header h1 { font-size: 28px; color: #1a1a2e; margin-bottom: 5px; }
    .page-header p { color: #666; }
    .btn-primary { background: #4361ee; color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; }
    .btn-primary:hover { background: #3651d4; }
    
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .stat-card { background: white; border-radius: 12px; padding: 20px; display: flex; align-items: center; gap: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .stat-icon { width: 56px; height: 56px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    .stat-icon.blue { background: #eef2ff; }
    .stat-icon.purple { background: #f3e8ff; }
    .stat-icon.gold { background: #fef3c7; }
    .stat-icon.green { background: #d1fae5; }
    .stat-icon.red { background: #fee2e2; }
    .stat-icon.orange { background: #ffedd5; }
    .stat-info h3 { font-size: 28px; color: #1a1a2e; margin-bottom: 2px; }
    .stat-info p { color: #666; font-size: 14px; }
    
    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 24px; }
    .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .card h3 { font-size: 16px; color: #1a1a2e; margin-bottom: 16px; }
    
    .attendance-bar-item { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
    .attendance-bar-item span:first-child { width: 100px; font-size: 14px; color: #666; }
    .attendance-bar { flex: 1; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; }
    .attendance-fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
    .attendance-fill.participants { background: #4361ee; }
    .attendance-fill.vip { background: #7209b7; }
    .attendance-bar-item span:last-child { width: 50px; font-size: 14px; font-weight: 600; color: #1a1a2e; text-align: right; }
    
    .vip-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 16px; margin-top: 20px; }
    .vip-card { background: white; border-radius: 12px; padding: 16px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); position: relative; }
    .vip-ranking { position: absolute; top: 10px; right: 10px; background: #4361ee; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 12px; }
    .vip-avatar { width: 56px; height: 56px; background: linear-gradient(135deg, #4361ee, #7209b7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; margin: 0 auto 10px; }
    .vip-card h3 { font-size: 16px; color: #1a1a2e; margin-bottom: 4px; }
    .vip-designation { color: #666; font-size: 13px; margin-bottom: 2px; }
    .vip-org { color: #4361ee; font-size: 12px; margin-bottom: 10px; }
    .vip-stats { display: flex; justify-content: center; gap: 16px; padding: 10px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px; font-size: 12px; }
    .status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 500; }
    .status-badge.active { background: #d1fae5; color: #059669; }
    
    .table-container { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); overflow: hidden; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th { background: #f8f9fa; padding: 14px 16px; text-align: left; font-weight: 600; color: #666; font-size: 12px; text-transform: uppercase; }
    td { padding: 14px 16px; border-top: 1px solid #e0e0e0; font-size: 14px; }
    .badge { background: #eef2ff; color: #4361ee; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
    .sport-tag { background: #d1fae5; color: #059669; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-right: 4px; display: inline-block; margin-bottom: 2px; }
    .table-scroll { max-height: 500px; overflow-y: auto; }
    
    .attendance-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .stat-box { background: white; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .stat-box h4 { color: #666; font-size: 14px; margin-bottom: 10px; }
    .stat-numbers { font-size: 28px; font-weight: 700; color: #1a1a2e; }
    .stat-numbers .present { color: #059669; }
    
    .attendance-sections { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
    .attendance-section { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .attendance-section h3 { margin-bottom: 16px; color: #1a1a2e; }
    .attendance-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #e0e0e0; margin-bottom: 8px; }
    .attendance-item.present { border-left-color: #059669; background: #d1fae5; }
    .attendance-item.absent { border-left-color: #dc2626; background: #fee2e2; }
    .item-info { display: flex; align-items: center; gap: 10px; }
    .item-id { background: #4361ee; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; }
    .item-name { font-weight: 500; font-size: 13px; }
    .item-actions { display: flex; gap: 6px; }
    .status-btn { padding: 6px 12px; border: none; border-radius: 4px; font-size: 11px; cursor: pointer; opacity: 0.6; }
    .status-btn.active { opacity: 1; }
    .status-btn.present { background: #059669; color: white; }
    .status-btn.absent { background: #dc2626; color: white; }
    
    .mc-grid { display: grid; grid-template-columns: 280px 1fr 280px; gap: 20px; margin-bottom: 24px; }
    .mc-section { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .mc-section h3 { font-size: 15px; color: #1a1a2e; margin-bottom: 16px; }
    .vip-list { display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto; }
    .vip-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
    .vip-item:hover { background: #eef2ff; }
    .vip-item.selected { background: #eef2ff; border-color: #4361ee; }
    
    .sports-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; margin-top: 20px; }
    .sport-card { background: white; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.2s; }
    .sport-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .sport-icon { font-size: 36px; margin-bottom: 10px; }
    .sport-card h4 { font-size: 16px; color: #1a1a2e; margin-bottom: 4px; }
    .sport-card p { font-size: 13px; color: #4361ee; font-weight: 500; }
    
    .teams-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
    .team-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .team-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #e0e0e0; }
    .team-header h3 { font-size: 18px; color: #1a1a2e; }
    .team-header .sport-badge { background: #4361ee; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; }
    .team-members { display: flex; flex-wrap: wrap; gap: 8px; }
    .team-member { background: #f8f9fa; padding: 6px 12px; border-radius: 20px; font-size: 12px; display: flex; align-items: center; gap: 6px; }
    .team-member .remove { color: #dc2626; cursor: pointer; font-weight: bold; }
    
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
    .modal { background: white; border-radius: 16px; width: 100%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #e0e0e0; }
    .modal-header h2 { font-size: 18px; color: #1a1a2e; }
    .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #666; }
    .modal-body { padding: 20px; }
    .modal-footer { display: flex; gap: 12px; justify-content: flex-end; padding: 20px; border-top: 1px solid #e0e0e0; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; font-size: 14px; }
    
    .search-box { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
    .search-box input, .search-box select { padding: 10px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; flex: 1; min-width: 200px; }
    .search-box input:focus, .search-box select:focus { outline: none; border-color: #4361ee; }
    
    .hidden { display: none !important; }
    .loading { display: flex; justify-content: center; align-items: center; height: 50vh; font-size: 18px; color: #666; }
    
    .filter-tabs { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
    .filter-tab { padding: 8px 16px; border: none; background: #e0e0e0; border-radius: 20px; cursor: pointer; font-size: 13px; }
    .filter-tab.active { background: #4361ee; color: white; }
    
    .action-btns { display: flex; gap: 6px; }
    .btn-action { padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
    .btn-delete { background: #fee2e2; color: #dc2626; }
    .btn-delete:hover { background: #fecaca; }
    .btn-edit { background: #eef2ff; color: #4361ee; }
    .btn-edit:hover { background: #dbeafe; }
    
    /* Shield Assignment Page */
    .shield-assign-container { display: grid; grid-template-columns: 320px 1fr; gap: 24px; }
    .shield-assign-sidebar { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); height: fit-content; position: sticky; top: 90px; }
    .shield-assign-sidebar h3 { font-size: 16px; color: #1a1a2e; margin-bottom: 16px; }
    .goh-select-list { display: flex; flex-direction: column; gap: 10px; max-height: 500px; overflow-y: auto; }
    .goh-select-item { display: flex; align-items: center; gap: 12px; padding: 14px; background: #f8f9fa; border-radius: 10px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
    .goh-select-item:hover { background: #eef2ff; border-color: #4361ee; }
    .goh-select-item.selected { background: #eef2ff; border-color: #4361ee; }
    .goh-select-avatar { width: 44px; height: 44px; background: linear-gradient(135deg, #4361ee, #7209b7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; flex-shrink: 0; }
    .goh-select-info { flex: 1; min-width: 0; }
    .goh-select-name { font-weight: 600; font-size: 14px; color: #1a1a2e; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .goh-select-org { font-size: 12px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .goh-select-budget { text-align: center; min-width: 50px; }
    .goh-budget-remaining { font-size: 20px; font-weight: 700; color: #4361ee; }
    .goh-budget-label { font-size: 10px; color: #666; }
    .goh-budget-used { font-size: 11px; color: #dc2626; }
    
    .shield-assign-main { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); min-height: 500px; }
    .shield-assign-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 400px; text-align: center; color: #666; }
    .shield-assign-placeholder h3 { font-size: 20px; color: #1a1a2e; margin-bottom: 10px; }
    
    .selected-goh-header { display: flex; align-items: center; gap: 20px; padding-bottom: 20px; border-bottom: 1px solid #e0e0e0; margin-bottom: 20px; }
    .selected-goh-avatar { width: 70px; height: 70px; background: linear-gradient(135deg, #4361ee, #7209b7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: 700; }
    .selected-goh-details h2 { font-size: 22px; color: #1a1a2e; margin-bottom: 4px; }
    .selected-goh-details p { color: #666; font-size: 14px; margin-bottom: 8px; }
    .shield-progress-card { background: #f8f9fa; padding: 16px; border-radius: 10px; display: flex; align-items: center; gap: 16px; }
    .shield-progress-bar { flex: 1; height: 12px; background: #e0e0e0; border-radius: 6px; overflow: hidden; }
    .shield-progress-fill { height: 100%; background: linear-gradient(90deg, #4361ee, #7209b7); border-radius: 6px; transition: width 0.3s; }
    .shield-progress-text { font-weight: 600; color: #1a1a2e; min-width: 80px; text-align: right; }
    
    .shield-assign-section { margin-top: 24px; }
    .shield-assign-section h3 { font-size: 16px; color: #1a1a2e; margin-bottom: 16px; }
    
    .participant-select-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; max-height: 400px; overflow-y: auto; }
    .participant-select-card { display: flex; align-items: center; gap: 12px; padding: 14px; background: #f8f9fa; border-radius: 10px; border: 2px solid transparent; cursor: pointer; transition: all 0.2s; }
    .participant-select-card:hover { background: #eef2ff; border-color: #4361ee; }
    .participant-select-card.selected { background: #d1fae5; border-color: #059669; }
    .participant-select-card input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
    .participant-select-info { flex: 1; min-width: 0; }
    .participant-select-name { font-weight: 600; font-size: 14px; color: #1a1a2e; }
    .participant-select-org { font-size: 12px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .participant-select-sports { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px; }
    .participant-select-sport { background: #eef2ff; color: #4361ee; padding: 2px 6px; border-radius: 4px; font-size: 10px; }
    
    .award-form { background: #f8f9fa; padding: 20px; border-radius: 12px; margin-top: 20px; }
    .award-form-row { display: flex; gap: 12px; align-items: flex-end; flex-wrap: wrap; }
    .award-form .form-group { flex: 1; min-width: 200px; margin-bottom: 0; }
    .award-form textarea { min-height: 80px; resize: vertical; }
    
    .awarded-history { margin-top: 24px; }
    .awarded-history h3 { font-size: 16px; color: #1a1a2e; margin-bottom: 16px; }
    .awarded-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid #ffd700; }
    .awarded-item-recipient { flex: 1; }
    .awarded-item-name { font-weight: 600; font-size: 14px; color: #1a1a2e; }
    .awarded-item-reason { font-size: 12px; color: #666; }
    .awarded-item-date { font-size: 12px; color: #999; }
    .awarded-item-sport { background: #d1fae5; color: #059669; padding: 2px 8px; border-radius: 4px; font-size: 11px; }
    .awarded-item-actions { display: flex; gap: 8px; }
    
    .empty-history { text-align: center; padding: 40px; color: #999; }
    .empty-history-icon { font-size: 48px; margin-bottom: 10px; }
    
    /* Teams Page */
    .teams-by-sport { margin-bottom: 30px; }
    .sport-team-section { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
    .sport-team-header { display: flex; align-items: center; justify-content: space-between; padding-bottom: 16px; border-bottom: 1px solid #e0e0e0; margin-bottom: 16px; }
    .sport-team-title { display: flex; align-items: center; gap: 12px; }
    .sport-team-icon { font-size: 28px; }
    .sport-team-name { font-size: 20px; font-weight: 700; color: #1a1a2e; }
    .sport-team-count { font-size: 14px; color: #666; }
    .sport-team-players { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 16px; }
    .team-player-chip { display: flex; align-items: center; gap: 8px; background: #f8f9fa; padding: 8px 12px; border-radius: 8px; border: 2px solid transparent; transition: all 0.2s; }
    .team-player-chip:hover { background: #eef2ff; border-color: #4361ee; }
    .team-player-avatar { width: 32px; height: 32px; background: linear-gradient(135deg, #4361ee, #7209b7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px; }
    .team-player-info { display: flex; flex-direction: column; }
    .team-player-name { font-weight: 600; font-size: 13px; color: #1a1a2e; }
    .team-player-sports { font-size: 10px; color: #666; }
    .team-player-remove { color: #dc2626; cursor: pointer; padding: 4px; opacity: 0.6; transition: opacity 0.2s; }
    .team-player-remove:hover { opacity: 1; }
    .team-player-add { display: flex; align-items: center; gap: 8px; background: #d1fae5; padding: 8px 12px; border-radius: 8px; cursor: pointer; border: 2px dashed #059669; transition: all 0.2s; color: #059669; font-weight: 600; font-size: 13px; }
    .team-player-add:hover { background: #a7f3d0; }
    
    .add-player-modal-content { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px; max-height: 400px; overflow-y: auto; }
    .add-player-option { display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8f9fa; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
    .add-player-option:hover { background: #eef2ff; border-color: #4361ee; }
    .add-player-option.selected { background: #d1fae5; border-color: #059669; }
    .add-player-option input[type="checkbox"] { width: 18px; height: 18px; }
    
    .no-teams-message { text-align: center; padding: 60px 20px; color: #666; }
    .no-teams-message-icon { font-size: 64px; margin-bottom: 16px; }
    .no-teams-message h3 { font-size: 20px; color: #1a1a2e; margin-bottom: 8px; }
    
    .player-multisport-badge { display: inline-flex; gap: 4px; margin-top: 4px; }
    .player-multisport-tag { background: #eef2ff; color: #4361ee; padding: 2px 6px; border-radius: 4px; font-size: 10px; }
    
    /* Event Day Page */
    .event-day-container { display: grid; grid-template-columns: 280px 1fr; gap: 24px; }
    .event-day-sidebar { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); height: fit-content; position: sticky; top: 90px; }
    .event-day-sidebar h3 { font-size: 16px; color: #1a1a2e; margin-bottom: 16px; }
    .event-present-list { display: flex; flex-direction: column; gap: 10px; max-height: 600px; overflow-y: auto; }
    .event-present-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #059669; }
    .event-present-avatar { width: 40px; height: 40px; background: linear-gradient(135deg, #4361ee, #7209b7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0; }
    .event-present-info { flex: 1; min-width: 0; }
    .event-present-name { font-weight: 600; font-size: 14px; color: #1a1a2e; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .event-present-org { font-size: 11px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .event-present-status { font-size: 10px; background: #d1fae5; color: #059669; padding: 2px 6px; border-radius: 10px; }
    .event-day-main { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .event-day-header { display: flex; align-items: center; gap: 20px; padding-bottom: 20px; border-bottom: 1px solid #e0e0e0; margin-bottom: 24px; }
    .event-day-header h2 { font-size: 24px; color: #1a1a2e; }
    .event-day-stats { display: flex; gap: 16px; }
    .event-day-stat { background: #f8f9fa; padding: 8px 16px; border-radius: 8px; font-size: 13px; }
    .event-day-stat span { font-weight: 700; color: #4361ee; }
    .event-sport-section { background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
    .event-sport-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .event-sport-title { display: flex; align-items: center; gap: 12px; }
    .event-sport-icon { font-size: 32px; }
    .event-sport-name { font-size: 20px; font-weight: 700; color: #1a1a2e; }
    .event-sport-count { font-size: 14px; color: #666; }
    .event-team-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
    .event-team-card { background: white; border-radius: 10px; padding: 16px; border: 2px solid #e0e0e0; }
    .event-team-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid #e0e0e0; }
    .event-team-name { font-weight: 600; font-size: 15px; color: #1a1a2e; }
    .event-team-members { display: flex; flex-wrap: wrap; gap: 8px; }
    .event-team-member { display: flex; align-items: center; gap: 6px; background: #eef2ff; padding: 6px 10px; border-radius: 20px; font-size: 12px; }
    .event-team-member-avatar { width: 24px; height: 24px; background: linear-gradient(135deg, #4361ee, #7209b7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 10px; }
    .event-no-data { text-align: center; padding: 60px 20px; color: #666; }
    .event-no-data-icon { font-size: 64px; margin-bottom: 16px; }
    .event-no-data h3 { font-size: 20px; color: #1a1a2e; margin-bottom: 8px; }
    .event-goh-section { margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid #e0e0e0; }
    .event-goh-title { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
    .event-goh-icon { font-size: 24px; }
    .event-goh-name { font-size: 18px; font-weight: 700; color: #1a1a2e; }
    .event-goh-grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .event-goh-chip { display: flex; align-items: center; gap: 8px; background: #fef3c7; padding: 8px 14px; border-radius: 20px; font-size: 13px; border: 2px solid #f59e0b; }
    .event-goh-chip-avatar { width: 28px; height: 28px; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px; }
    
    /* Players Page */
    .players-container { display: grid; grid-template-columns: 1fr 360px; gap: 24px; }
    .players-list-panel { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .players-list-panel h3 { font-size: 16px; color: #1a1a2e; margin-bottom: 16px; }
    .player-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 12px; max-height: 70vh; overflow-y: auto; }
    .player-list-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 10px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
    .player-list-item:hover { background: #eef2ff; border-color: #4361ee; }
    .player-list-item.selected { background: #eef2ff; border-color: #4361ee; }
    .player-list-avatar { width: 44px; height: 44px; background: linear-gradient(135deg, #4361ee, #7209b7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; flex-shrink: 0; }
    .player-list-info { flex: 1; min-width: 0; }
    .player-list-name { font-weight: 600; font-size: 14px; color: #1a1a2e; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .player-list-org { font-size: 11px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .player-list-sports { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 4px; }
    .player-list-sport { background: #eef2ff; color: #4361ee; padding: 2px 6px; border-radius: 4px; font-size: 9px; }
    .players-detail-panel { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); height: fit-content; position: sticky; top: 90px; }
    .player-detail-header { display: flex; flex-direction: column; align-items: center; text-align: center; margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid #e0e0e0; }
    .player-detail-avatar { width: 80px; height: 80px; background: linear-gradient(135deg, #4361ee, #7209b7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 32px; margin-bottom: 16px; }
    .player-detail-name { font-size: 22px; font-weight: 700; color: #1a1a2e; margin-bottom: 4px; }
    .player-detail-designation { color: #666; font-size: 14px; margin-bottom: 2px; }
    .player-detail-org { color: #4361ee; font-size: 13px; margin-bottom: 12px; }
    .player-detail-contact { display: flex; gap: 16px; justify-content: center; font-size: 12px; color: #666; }
    .player-detail-section { margin-bottom: 20px; }
    .player-detail-section h4 { font-size: 14px; color: #1a1a2e; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .player-sports-grid { display: flex; flex-wrap: wrap; gap: 8px; }
    .player-sport-chip { display: flex; align-items: center; gap: 8px; background: #eef2ff; padding: 8px 14px; border-radius: 20px; font-size: 13px; }
    .player-sport-icon { font-size: 18px; }
    .player-team-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid #4361ee; }
    .player-team-info { flex: 1; }
    .player-team-name { font-weight: 600; font-size: 14px; color: #1a1a2e; }
    .player-team-sport { font-size: 12px; color: #4361ee; }
    .player-team-members { font-size: 11px; color: #666; }
    .player-shield-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #fef3c7; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid #ffd700; }
    .player-shield-icon { font-size: 24px; }
    .player-shield-info { flex: 1; }
    .player-shield-awardedby { font-weight: 600; font-size: 13px; color: #1a1a2e; }
    .player-shield-reason { font-size: 11px; color: #666; }
    .player-shield-date { font-size: 11px; color: #999; }
    .player-empty { text-align: center; padding: 60px 20px; color: #999; }
    .player-empty-icon { font-size: 64px; margin-bottom: 16px; opacity: 0.5; }
    .player-attendance-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; background: #f8f9fa; border-radius: 8px; margin-bottom: 6px; }
    .player-attendance-date { font-size: 13px; color: #666; }
    .player-attendance-status { font-size: 11px; padding: 4px 10px; border-radius: 10px; }
    .player-attendance-status.present { background: #d1fae5; color: #059669; }
    .player-attendance-status.absent { background: #fee2e2; color: #dc2626; }
    
    /* Participant Portal */
    .participant-portal-container { max-width: 500px; margin: 0 auto; padding: 20px; }
    .participant-login-card { background: white; border-radius: 16px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    .participant-login-header { text-align: center; margin-bottom: 30px; }
    .participant-login-header .icon { font-size: 64px; margin-bottom: 16px; }
    .participant-login-header h1 { font-size: 24px; color: #1a1a2e; margin-bottom: 8px; }
    .participant-login-header p { color: #666; font-size: 14px; }
    .participant-dashboard { background: white; border-radius: 16px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    .participant-header { display: flex; align-items: center; gap: 20px; padding-bottom: 20px; border-bottom: 1px solid #e0e0e0; margin-bottom: 24px; }
    .participant-avatar { width: 70px; height: 70px; background: linear-gradient(135deg, #4361ee, #7209b7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: 700; }
    .participant-info h2 { font-size: 22px; color: #1a1a2e; margin-bottom: 4px; }
    .participant-info p { color: #666; font-size: 14px; }
    .participant-sports { margin-bottom: 24px; }
    .participant-sports h3 { font-size: 14px; color: #666; margin-bottom: 12px; }
    .participant-sport-chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .participant-sport-chip { display: flex; align-items: center; gap: 8px; background: #eef2ff; padding: 8px 14px; border-radius: 20px; font-size: 14px; }
    .participant-sport-chip .icon { font-size: 18px; }
    .attendance-mark-section { margin-bottom: 24px; }
    .attendance-mark-section h3 { font-size: 16px; color: #1a1a2e; margin-bottom: 16px; }
    .attendance-date-selector { margin-bottom: 16px; }
    .attendance-date-selector label { display: block; font-size: 14px; color: #666; margin-bottom: 8px; }
    .attendance-date-selector input { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; }
    .attendance-btn { width: 100%; padding: 16px; background: #059669; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .attendance-btn:hover { background: #047857; transform: translateY(-2px); }
    .attendance-btn.present { background: #059669; }
    .attendance-btn.absent { background: #dc2626; }
    .attendance-status-display { padding: 16px; border-radius: 10px; text-align: center; font-size: 16px; font-weight: 600; margin-top: 16px; }
    .attendance-status-display.present { background: #d1fae5; color: #059669; }
    .attendance-status-display.absent { background: #fee2e2; color: #dc2626; }
    .attendance-status-display.pending { background: #f8f9fa; color: #666; }
    .participant-history { margin-top: 24px; }
    .participant-history h3 { font-size: 16px; color: #1a1a2e; margin-bottom: 16px; }
    .history-item { display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f8f9fa; border-radius: 8px; margin-bottom: 8px; }
    .history-date { font-size: 14px; color: #666; }
    .history-status { font-size: 12px; padding: 4px 12px; border-radius: 10px; }
    .history-status.present { background: #d1fae5; color: #059669; }
    .history-status.absent { background: #fee2e2; color: #dc2626; }
    .participant-logout { margin-top: 24px; text-align: center; }
    .participant-logout button { background: none; border: none; color: #666; cursor: pointer; font-size: 14px; }
    .participant-logout button:hover { color: #dc2626; }
    
    @media (max-width: 1024px) { .shield-assign-container { grid-template-columns: 1fr; } .shield-assign-sidebar { position: static; } }
    @media (max-width: 768px) { .sidebar { width: 70px; } .sidebar-header h1, .nav-label, .user-info { display: none; } .nav-item { justify-content: center; padding: 14px; } .main-content { margin-left: 70px; } .dashboard-grid { grid-template-columns: 1fr; } .attendance-sections { grid-template-columns: 1fr; } .form-row { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div id="loginPage" class="login-page">
    <div class="login-card">
      <div class="login-header">
        <div class="logo">üèÜ</div>
        <h1>Olympiad</h1>
        <p>Sports Management System</p>
      </div>
      <div id="loginError" class="error hidden">Invalid credentials</div>
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label>Username</label>
          <input type="text" id="username" placeholder="Enter username" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="password" placeholder="Enter password" required>
        </div>
        <button type="submit" class="btn">Sign In</button>
      </form>
      <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
        <p style="color: #666; font-size: 13px;">Demo: admin / admin123</p>
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div id="appPage" class="app-layout hidden">
    <aside class="sidebar">
      <div class="sidebar-header">
        <span class="logo">üèÜ</span>
        <h1>Olympiad</h1>
      </div>
      <nav class="nav">
        <div class="nav-item active" id="nav-dashboard" onclick="showPage('dashboard')">
          <span class="nav-icon">üìä</span>
          <span class="nav-label">Dashboard</span>
        </div>
        <div class="nav-item" id="nav-participants" onclick="showPage('participants')">
          <span class="nav-icon">üë•</span>
          <span class="nav-label">Participants</span>
        </div>
        <div class="nav-item" id="nav-vip" onclick="showPage('vip')">
          <span class="nav-icon">‚≠ê</span>
          <span class="nav-label">VIP / GOH</span>
        </div>
        <div class="nav-item" id="nav-sports" onclick="showPage('sports')">
          <span class="nav-icon">‚öΩ</span>
          <span class="nav-label">Sports</span>
        </div>
        <div class="nav-item" id="nav-teams" onclick="showPage('teams')">
          <span class="nav-icon">üë•</span>
          <span class="nav-label">Teams</span>
        </div>
        <div class="nav-item" id="nav-attendance" onclick="showPage('attendance')">
          <span class="nav-icon">üìã</span>
          <span class="nav-label">Attendance</span>
        </div>
        <div class="nav-item" id="nav-shields" onclick="showPage('shields')">
          <span class="nav-icon">üèÜ</span>
          <span class="nav-label">Shields</span>
        </div>
        <div class="nav-item" id="nav-shieldAssignment" onclick="showPage('shieldAssignment')">
          <span class="nav-icon">üõ°Ô∏è</span>
          <span class="nav-label">Assign Shields</span>
        </div>
        <div class="nav-item" id="nav-mc" onclick="showPage('mc')">
          <span class="nav-icon">üé§</span>
          <span class="nav-label">MC Panel</span>
        </div>
        <div class="nav-item" id="nav-eventday" onclick="showPage('eventday')">
          <span class="nav-icon">üìÖ</span>
          <span class="nav-label">Event Day</span>
        </div>
        <div class="nav-item" id="nav-players" onclick="showPage('players')">
          <span class="nav-icon">üë§</span>
          <span class="nav-label">Players</span>
        </div>
        <div class="nav-item" id="nav-participant-portal" onclick="showPage('participantPortal')">
          <span class="nav-icon">üì±</span>
          <span class="nav-label">Participant Portal</span>
        </div>
      </nav>
      <div class="sidebar-footer">
        <div class="user-info">
          <span class="user-role" id="userRole">Admin</span>
          <span class="user-name" id="userName">admin</span>
        </div>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </aside>

    <main class="main-content">
      <!-- Dashboard -->
      <div id="dashboardPage">
        <div class="page-header">
          <div>
            <h1>Dashboard</h1>
            <p>Olympiad Sports Management Overview</p>
          </div>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon blue">üë•</div>
            <div class="stat-info">
              <h3 id="participantCount">0</h3>
              <p>Total Participants</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon purple">‚≠ê</div>
            <div class="stat-info">
              <h3 id="vipCount">0</h3>
              <p>VIP / GOH</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon orange">‚öΩ</div>
            <div class="stat-info">
              <h3 id="sportCount">0</h3>
              <p>Sports</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon gold">üèÜ</div>
            <div class="stat-info">
              <h3 id="shieldCount">0</h3>
              <p>Shields Awarded</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon green">‚úÖ</div>
            <div class="stat-info">
              <h3 id="attendanceRate">0%</h3>
              <p>Attendance Rate</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon red">üë•</div>
            <div class="stat-info">
              <h3 id="teamCount">0</h3>
              <p>Teams</p>
            </div>
          </div>
        </div>
        <div class="dashboard-grid">
          <div class="card">
            <h3>Attendance Overview</h3>
            <div class="attendance-bar-item">
              <span>Participants</span>
              <div class="attendance-bar"><div class="attendance-fill participants" style="width: 0%" id="participantBar"></div></div>
              <span id="participantRate">0%</span>
            </div>
            <div class="attendance-bar-item">
              <span>VIP / GOH</span>
              <div class="attendance-bar"><div class="attendance-fill vip" style="width: 0%" id="vipBar"></div></div>
              <span id="vipRate">0%</span>
            </div>
          </div>
          <div class="card">
            <h3>Quick Actions</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;">
              <button class="btn-primary btn-small" onclick="showPage('attendance')">üìã Attendance</button>
              <button class="btn-primary btn-small" onclick="showPage('participants')">üë• Participants</button>
              <button class="btn-primary btn-small" onclick="showPage('teams')">üë• Create Team</button>
              <button class="btn-primary btn-small" onclick="showPage('shields')">üèÜ Award Shield</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Participants -->
      <div id="participantsPage" class="hidden">
        <div class="page-header">
          <div>
            <h1>Participants</h1>
            <p>All registered participants</p>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn-primary" onclick="document.getElementById('participantCsvInput').click()">üì§ Bulk Upload CSV</button>
            <button class="btn-secondary btn-small" onclick="showAddSingleParticipant()">+ Add Single</button>
            <input type="file" id="participantCsvInput" accept=".csv" style="display:none" onchange="handleParticipantCsvUpload(this)">
          </div>
        </div>
        <div class="search-box">
          <input type="text" id="participantSearch" placeholder="Search by name..." oninput="filterParticipants()">
          <select id="sportFilter" onchange="filterParticipants()">
            <option value="">All Sports</option>
          </select>
        </div>
        <div class="table-container">
          <div class="table-scroll">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Designation</th>
                  <th>Organization</th>
                  <th>Contact</th>
                  <th>Sports</th>
                  <th style="width: 80px;">Actions</th>
                </tr>
              </thead>
              <tbody id="participantsTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- VIP / GOH -->
      <div id="vipPage" class="hidden">
        <div class="page-header">
          <div>
            <h1>VIP / Guests of Honor</h1>
            <p>Distinguished guests and dignitaries</p>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn-primary" onclick="document.getElementById('vipCsvInput').click()">üì§ Bulk Upload CSV</button>
            <button class="btn-secondary btn-small" onclick="showAddSingleVip()">+ Add VIP</button>
            <input type="file" id="vipCsvInput" accept=".csv" style="display:none" onchange="handleVipCsvUpload(this)">
          </div>
        </div>
        <div class="search-box">
          <input type="text" id="vipSearch" placeholder="Search by name..." oninput="filterVips()">
        </div>
        <div class="vip-grid" id="vipGrid"></div>
      </div>

      <!-- Sports -->
      <div id="sportsPage" class="hidden">
        <div class="page-header">
          <div>
            <h1>Sports</h1>
            <p>All available sports in Olympiad</p>
          </div>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon blue">‚öΩ</div>
            <div class="stat-info">
              <h3 id="totalSports">0</h3>
              <p>Total Sports</p>
            </div>
          </div>
        </div>
        <div class="sports-grid" id="sportsGrid"></div>
      </div>

      <!-- Teams -->
      <div id="teamsPage" class="hidden">
        <div class="page-header">
          <div>
            <h1>üèÜ Team Management</h1>
            <p>Organize players into sports teams - one player can be in multiple sports</p>
          </div>
          <button class="btn-primary" onclick="showCreateTeamModal()">+ Create Team</button>
        </div>
        
        <div class="search-box">
          <select id="teamSportFilter" onchange="filterTeams()">
            <option value="">All Sports</option>
          </select>
          <select id="teamPlayerFilter" onchange="filterTeams()">
            <option value="">All Players</option>
          </select>
        </div>
        
        <!-- Teams by Sport -->
        <div id="teamsBySport"></div>
      </div>

      <!-- Attendance -->
      <div id="attendancePage" class="hidden">
        <div class="page-header">
          <div>
            <h1>Attendance</h1>
            <p>Track presence of participants and VIPs</p>
          </div>
          <input type="date" id="attendanceDate" style="padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
        </div>
        <div class="attendance-stats">
          <div class="stat-box">
            <h4>Participants</h4>
            <div class="stat-numbers"><span class="present" id="participantPresent">0</span>/<span id="participantTotal">0</span></div>
            <p>Present Today</p>
          </div>
          <div class="stat-box">
            <h4>VIP / GOH</h4>
            <div class="stat-numbers"><span class="present" id="vipPresent">0</span>/<span id="vipTotal">0</span></div>
            <p>Present Today</p>
          </div>
        </div>
        <div class="attendance-sections">
          <div class="attendance-section">
            <h3>Participants</h3>
            <div id="participantAttendance"></div>
          </div>
          <div class="attendance-section">
            <h3>VIP / GOH</h3>
            <div id="vipAttendance"></div>
          </div>
        </div>
      </div>

      <!-- Shields -->
      <div id="shieldsPage" class="hidden">
        <div class="page-header">
          <div>
            <h1>Shield Awards</h1>
            <p>Recognize outstanding performance</p>
          </div>
          <button class="btn-primary" onclick="awardShield()">+ Award Shield</button>
        </div>
        <div class="table-container">
          <div class="table-scroll">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Recipient</th>
                  <th>Awarded By</th>
                  <th>Sport</th>
                  <th>Reason</th>
                  <th>Date</th>
                  <th style="width: 80px;">Actions</th>
                </tr>
              </thead>
              <tbody id="shieldsTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Shield Assignment Page -->
      <div id="shieldAssignmentPage" class="hidden">
        <div class="page-header">
          <div>
            <h1>üõ°Ô∏è Shield Assignment</h1>
            <p>Award shields to participants by selecting a GOH</p>
          </div>
        </div>
        
        <div class="shield-assign-container">
          <!-- GOH List Panel -->
          <div class="shield-assign-sidebar">
            <h3>üéñÔ∏è Select GOH</h3>
            <div class="goh-select-list" id="gohSelectList"></div>
          </div>
          
          <!-- Main Content Panel -->
          <div class="shield-assign-main">
            <div id="shieldAssignContent">
              <div class="shield-assign-placeholder">
                <div style="font-size: 64px; margin-bottom: 20px;">üõ°Ô∏è</div>
                <h3>Select a GOH to Award Shields</h3>
                <p>Click on a Guest of Honor from the left panel to assign shields to participants</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Player to Team Modal -->
      <div id="addPlayerToTeamModal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 700px;">
          <div class="modal-header">
            <h2 id="addPlayerModalTitle">Add Players to Team</h2>
            <button class="modal-close" onclick="closeModal('addPlayerToTeamModal')">&times;</button>
          </div>
          <div class="modal-body">
            <p style="color: #666; margin-bottom: 16px;" id="addPlayerModalSubtitle">Select players to add to this team</p>
            <div class="add-player-modal-content" id="addPlayerList"></div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary btn-small" onclick="closeModal('addPlayerToTeamModal')">Cancel</button>
            <button class="btn btn-small" onclick="saveAddedPlayers()">Add Selected Players</button>
          </div>
        </div>
      </div>

      <!-- MC Panel -->
      <div id="mcPage" class="hidden">
        <div class="page-header">
          <div>
            <h1>üé§ Master of Ceremony Dashboard</h1>
            <p>Shield Assignment Overview</p>
          </div>
        </div>
        <div class="mc-grid">
          <div class="mc-section">
            <h3>üîú VIP / GOH List</h3>
            <div class="vip-list" id="mcVipList"></div>
          </div>
          <div class="mc-section">
            <h3>üìã Shield Assignments</h3>
            <div id="mcAssignments">
              <p style="color: #999; text-align: center; padding: 40px;">Select a VIP from the left</p>
            </div>
          </div>
          <div class="mc-section">
            <h3>‚≠ê Top Shield Recipients</h3>
            <div id="topRecipients"></div>
          </div>
        </div>
      </div>

      <!-- Event Day Page -->
      <div id="eventdayPage" class="hidden">
        <div class="page-header">
          <div>
            <h1>üìÖ Event Day Overview</h1>
            <p>Present participants, GOH, sports and teams</p>
          </div>
          <input type="date" id="eventDayDate" style="padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
        </div>
        
        <div class="event-day-container">
          <!-- Left Sidebar - Present People -->
          <div class="event-day-sidebar">
            <h3>üë• Present Today</h3>
            <div class="event-present-list" id="eventPresentList"></div>
          </div>
          
          <!-- Main Content - Sports & Teams -->
          <div class="event-day-main" id="eventDayMain">
            <div class="event-day-header">
              <h2>üèÜ Event Day Summary</h2>
              <div class="event-day-stats">
                <div class="event-day-stat">Participants: <span id="eventPartCount">0</span></div>
                <div class="event-day-stat">GOH: <span id="eventGohCount">0</span></div>
                <div class="event-day-stat">Teams: <span id="eventTeamCount">0</span></div>
              </div>
            </div>
            
            <div id="eventDayContent"></div>
          </div>
        </div>
      </div>

      <!-- Players Page -->
      <div id="playersPage" class="hidden">
        <div class="page-header">
          <div>
            <h1>üë§ Players Profile</h1>
            <p>View detailed profiles of all participants</p>
          </div>
        </div>
        
        <div class="players-container">
          <!-- Left Panel - Player List -->
          <div class="players-list-panel">
            <h3>üìã All Players</h3>
            <div class="search-box" style="margin-bottom: 16px;">
              <input type="text" id="playerSearch" placeholder="Search by name..." oninput="renderPlayersList()">
              <select id="playerSportFilter" onchange="renderPlayersList()">
                <option value="">All Sports</option>
              </select>
            </div>
            <div class="player-list" id="playerList"></div>
          </div>
          
          <!-- Right Panel - Player Detail -->
          <div class="players-detail-panel" id="playerDetailPanel">
            <div class="player-empty">
              <div class="player-empty-icon">üë§</div>
              <h3>Select a Player</h3>
              <p>Click on a player from the list to view their profile</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Participant Portal Page -->
      <div id="participantPortalPage" class="hidden">
        <div class="participant-portal-container" id="participantPortalContent">
          <!-- Login Form -->
          <div class="participant-login-card" id="participantLoginCard">
            <div class="participant-login-header">
              <div class="icon">üì±</div>
              <h1>Participant Attendance Portal</h1>
              <p>Enter your email to mark your attendance</p>
            </div>
            <div class="form-group">
              <label>Email Address *</label>
              <input type="email" id="participantEmail" placeholder="Enter your email">
            </div>
            <div class="form-group">
              <label>Or Participant ID</label>
              <input type="text" id="participantId" placeholder="e.g., P-0001">
            </div>
            <button class="btn" onclick="participantLogin()">Continue</button>
            <p style="text-align: center; margin-top: 20px; color: #999; font-size: 12px;">
              Use the email or ID you registered with
            </p>
          </div>
          
          <!-- Participant Dashboard -->
          <div class="participant-dashboard hidden" id="participantDashboard">
            <div class="participant-header">
              <div class="participant-avatar" id="participantAvatar">P</div>
              <div class="participant-info">
                <h2 id="participantName">Participant Name</h2>
                <p id="participantOrg">Organization</p>
              </div>
            </div>
            
            <div class="participant-sports">
              <h3>Your Sports</h3>
              <div class="participant-sport-chips" id="participantSports"></div>
            </div>
            
            <div class="attendance-mark-section">
              <h3>üìã Mark Your Attendance</h3>
              <div class="attendance-date-selector">
                <label>Select Date</label>
                <input type="date" id="participantAttendanceDate">
              </div>
              <button class="attendance-btn present" onclick="markMyAttendance('Present')">
                ‚úÖ Mark Present
              </button>
              <div class="attendance-status-display pending" id="attendanceStatus">
                Select a date and mark your attendance
              </div>
            </div>
            
            <div class="participant-history">
              <h3>üìú Your Attendance History</h3>
              <div id="participantAttendanceHistory"></div>
            </div>
            
            <div class="participant-logout">
              <button onclick="participantLogout()">‚Üê Logout from Portal</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Add Single Participant Modal -->
  <div id="addParticipantModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2>Add New Participant</h2>
        <button class="modal-close" onclick="closeModal('addParticipantModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label>Full Name *</label>
            <input type="text" id="newPartName" placeholder="Enter name">
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" id="newPartEmail" placeholder="Enter email">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Designation</label>
            <input type="text" id="newPartDesignation" placeholder="Enter designation">
          </div>
          <div class="form-group">
            <label>Organization</label>
            <input type="text" id="newPartOrg" placeholder="Enter organization">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Phone</label>
            <input type="text" id="newPartPhone" placeholder="Enter phone">
          </div>
          <div class="form-group">
            <label>Sports (comma separated)</label>
            <input type="text" id="newPartSports" placeholder="e.g., Cricket, Football, Badminton">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-small" onclick="closeModal('addParticipantModal')">Cancel</button>
        <button class="btn btn-small" onclick="saveSingleParticipant()">Add Participant</button>
      </div>
    </div>
  </div>

  <!-- Add Single VIP Modal -->
  <div id="addVipModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2>Add New VIP / GOH</h2>
        <button class="modal-close" onclick="closeModal('addVipModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label>Full Name *</label>
            <input type="text" id="newVipName" placeholder="Enter name">
          </div>
          <div class="form-group">
            <label>Ranking (1-10) *</label>
            <input type="number" id="newVipRanking" min="1" max="10" placeholder="1-10">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Designation</label>
            <input type="text" id="newVipDesignation" placeholder="Enter designation">
          </div>
          <div class="form-group">
            <label>Organization</label>
            <input type="text" id="newVipOrg" placeholder="Enter organization">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Shield Budget</label>
            <input type="number" id="newVipBudget" value="5" min="0">
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input type="text" id="newVipPhone" placeholder="Enter phone">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-small" onclick="closeModal('addVipModal')">Cancel</button>
        <button class="btn btn-small" onclick="saveSingleVip()">Add VIP</button>
      </div>
    </div>
  </div>

  <!-- Bulk Upload Result Modal -->
  <div id="bulkUploadModal" class="modal-overlay hidden">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h2>Bulk Upload Results</h2>
        <button class="modal-close" onclick="closeModal('bulkUploadModal')">&times;</button>
      </div>
      <div class="modal-body" id="bulkUploadResults">
      </div>
      <div class="modal-footer">
        <button class="btn btn-small" onclick="closeModal('bulkUploadModal')">Close</button>
      </div>
    </div>
  </div>

  <!-- Create Team Modal -->
  <div id="createTeamModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2>Create New Team</h2>
        <button class="modal-close" onclick="closeModal('createTeamModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Team Name *</label>
          <input type="text" id="teamName" placeholder="Enter team name">
        </div>
        <div class="form-group">
          <label>Sport *</label>
          <select id="teamSport">
            <option value="">Select Sport</option>
          </select>
        </div>
        <div class="form-group">
          <label>Add Team Members *</label>
          <select id="teamMemberSelect" multiple style="height: 150px;">
          </select>
          <p style="font-size: 12px; color: #666; margin-top: 8px;">Hold Ctrl/Cmd to select multiple members</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-small" onclick="closeModal('createTeamModal')">Cancel</button>
        <button class="btn btn-small" onclick="createTeam()">Create Team</button>
      </div>
    </div>
  </div>

  <!-- Sport Participants Modal -->
  <div id="sportParticipantsModal" class="modal-overlay hidden">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <h2 id="sportParticipantsTitle">Sport Participants</h2>
        <button class="modal-close" onclick="closeModal('sportParticipantsModal')">&times;</button>
      </div>
      <div class="modal-body" id="sportParticipantsContent">
      </div>
      <div class="modal-footer">
        <button class="btn btn-small" onclick="closeModal('sportParticipantsModal')">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Data storage
    let participants = [];
    let vips = [];
    let sports = [];
    let teams = [];
    let shields = [];
    let attendance = {};
    let currentUser = null;

    // Sport icons mapping
    const sportIcons = {
      'Cricket': 'üèè', 'Football': '‚öΩ', 'Basketball': 'üèÄ', 'Volleyball': 'üèê',
      'Badminton': 'üè∏', 'Table Tennis': 'üèì', 'Tennis': 'üéæ', 'Chess': '‚ôüÔ∏è',
      'Athletics': 'üèÉ', 'Swimming': 'üèä', 'Paddle Tennis': 'üéæ',
      'Throwball': 'üèê', 'Snooker': 'üé±', 'Hockey': 'üèë'
    };

    // Initialize
    document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('attendanceDate').addEventListener('change', renderAttendance);

    function loadData() {
      const savedParticipants = localStorage.getItem('participants');
      const savedVips = localStorage.getItem('vips');
      const savedSports = localStorage.getItem('sports');
      const savedTeams = localStorage.getItem('teams');
      const savedShields = localStorage.getItem('shields');
      const savedAttendance = localStorage.getItem('attendance');
      
      if (savedParticipants) {
        participants = JSON.parse(savedParticipants);
      } else {
        initializeSampleData();
      }
      
      if (savedVips) {
        vips = JSON.parse(savedVips);
      }
      
      if (savedSports) {
        sports = JSON.parse(savedSports);
      } else {
        initializeSports();
      }
      
      if (savedTeams) {
        teams = JSON.parse(savedTeams);
      }
      
      if (savedShields) {
        shields = JSON.parse(savedShields);
      }
      
      if (savedAttendance) {
        attendance = JSON.parse(savedAttendance);
      }
    }

    function initializeSampleData() {
      participants = [
        { id: 'P-0001', name: 'Zafar Imam', designation: 'Head of IT', organization: 'Fauji Akbar Portia Marine Terminals', phone: '0331-8203888', email: 'Zafar.imam@fapterminals.com', sports: ['Paddle Tennis', 'Cricket', 'Snooker'] },
        { id: 'P-0002', name: 'Khawar Saleem', designation: 'Deputy Manager Digital Trust Assurance', organization: 'SGS Pakistan Private Limited', phone: '0323 2836231', email: 'Khawar.saleem@sgs.com', sports: ['Paddle Tennis', 'Cricket', 'Snooker'] },
      ];
      
      vips = [
        { id: 'V-001', name: 'Alay Raza', designation: 'Chief Information Security Officer (CISO)', organization: 'National Bank of Pakistan (NBP)', ranking: 1, status: 'Active', shields_given: 2, shield_budget: 5 },
        { id: 'V-002', name: 'Dr. Ahmad Khan', designation: 'Director', organization: 'Sports Federation', ranking: 2, status: 'Active', shields_given: 1, shield_budget: 4 },
      ];
      
      shields = [
        { id: 'SH-0001', recipient: 'Ali Ahmad', recipientId: 'P-0003', awardedBy: 'Alay Raza', awardedById: 'V-001', sport: 'Cricket', reason: 'Best cricketer award', date: '2024-02-01' },
      ];
      
      saveData();
    }

    function initializeSports() {
      sports = [
        { name: 'Cricket', icon: 'üèè', participants: 0 },
        { name: 'Football', icon: '‚öΩ', participants: 0 },
        { name: 'Basketball', icon: 'üèÄ', participants: 0 },
        { name: 'Volleyball', icon: 'üèê', participants: 0 },
        { name: 'Badminton', icon: 'üè∏', participants: 0 },
        { name: 'Table Tennis', icon: 'üèì', participants: 0 },
        { name: 'Tennis', icon: 'üéæ', participants: 0 },
        { name: 'Chess', icon: '‚ôüÔ∏è', participants: 0 },
        { name: 'Athletics', icon: 'üèÉ', participants: 0 },
        { name: 'Swimming', icon: 'üèä', participants: 0 },
        { name: 'Paddle Tennis', icon: 'üéæ', participants: 0 },
        { name: 'Throwball', icon: 'üèê', participants: 0 },
        { name: 'Snooker', icon: 'üé±', participants: 0 },
        { name: 'Hockey', icon: 'üèë', participants: 0 },
      ];
      saveData();
    }

    function saveData() {
      localStorage.setItem('participants', JSON.stringify(participants));
      localStorage.setItem('vips', JSON.stringify(vips));
      localStorage.setItem('sports', JSON.stringify(sports));
      localStorage.setItem('teams', JSON.stringify(teams));
      localStorage.setItem('shields', JSON.stringify(shields));
      localStorage.setItem('attendance', JSON.stringify(attendance));
    }

    async function importCSVData() {
      try {
        // Import participants
        const partResponse = await fetch('/Olympiad-partipants.csv');
        if (partResponse.ok) {
          const partText = await partResponse.text();
          const lines = partText.split('\n').slice(1);
          
          let importedCount = 0;
          lines.forEach((line, index) => {
            if (line.trim()) {
              const cols = line.split(',');
              if (cols.length >= 7 && cols[1] && cols[6]) {
                const sportsStr = cols[9] || '';
                const sportsList = sportsStr.replace(/"/g, '').split(',').map(s => s.trim()).filter(s => s && s !== 'NO' && s !== 'No' && s !== 'no');
                
                // Handle CSV parsing issues with commas in fields
                let name = cols[1]?.trim() || '';
                let org = cols[3]?.trim() || '';
                let desig = cols[2]?.trim() || '';
                let phone = cols[5]?.trim() || '';
                let email = cols[6]?.trim() || '';
                
                if (name && email && !participants.find(p => p.email === email)) {
                  participants.push({
                    id: 'P-' + String(participants.length + 1).padStart(4, '0'),
                    name,
                    designation: desig,
                    organization: org,
                    phone,
                    email,
                    sports: sportsList
                  });
                  importedCount++;
                }
              }
            }
          });
          
          if (importedCount > 0) {
            console.log('‚úÖ Imported ' + importedCount + ' participants from CSV');
          }
        }
        
        // Import VIPs
        const vipResponse = await fetch('/Olympiad-vip.csv');
        if (vipResponse.ok) {
          const vipText = await vipResponse.text();
          const lines = vipText.split('\n').slice(2);
          
          let rank = 1;
          lines.forEach((line) => {
            if (line.trim() && !line.includes('Specific Names') && !line.includes('I. Specific')) {
              const cols = line.split(',');
              if (cols.length >= 4 && cols[1] && cols[1] !== 'Name / Targeted Role' && !isNaN(parseInt(cols[0]))) {
                vips.push({
                  id: 'V-' + String(rank).padStart(3, '0'),
                  name: cols[1].trim(),
                  designation: cols[2] ? cols[2].trim() : '',
                  organization: cols[3] ? cols[3].trim() : '',
                  ranking: rank,
                  status: 'Active',
                  shields_given: 0,
                  shield_budget: 5
                });
                rank++;
              }
            }
          });
          
          console.log('‚úÖ Imported ' + (rank - 1) + ' VIPs from CSV');
        }
        
        // Update sport counts
        updateSportCounts();
        
        saveData();
        updateDashboard();
        
      } catch (error) {
        console.log('CSV import note: ' + error.message);
      }
    }

    function updateSportCounts() {
      sports.forEach(sport => {
        sport.participants = participants.filter(p => p.sports.includes(sport.name)).length;
      });
    }

    // Delete Functions
    function deleteParticipant(id) {
      if (!confirm('Are you sure you want to delete this participant?')) return;
      
      const participant = participants.find(p => p.id === id);
      if (participant) {
        // Also remove from teams
        teams.forEach(team => {
          team.members = team.members.filter(m => m.id !== id);
        });
        
        participants = participants.filter(p => p.id !== id);
        saveData();
        renderParticipants();
        renderTeams();
        updateDashboard();
        populateFilters();
      }
    }

    function deleteVip(id) {
      if (!confirm('Are you sure you want to delete this VIP?')) return;
      
      vips = vips.filter(v => v.id !== id);
      saveData();
      renderVip();
      updateDashboard();
    }

    function deleteShield(id) {
      if (!confirm('Are you sure you want to revoke/delete this shield award?')) return;
      
      const shield = shields.find(s => s.id === id);
      if (shield) {
        // Decrease shield count for the VIP
        const vip = vips.find(v => v.id === shield.awardedById);
        if (vip) {
          vip.shields_given = Math.max(0, vip.shields_given - 1);
        }
      }
      
      shields = shields.filter(s => s.id !== id);
      saveData();
      renderShields();
      renderMC();
      updateDashboard();
    }

    function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      if ((username === 'admin' || username === 'mc') && password === 'admin123') {
        currentUser = { username, role: username === 'admin' ? 'Admin' : 'MC' };
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('appPage').classList.remove('hidden');
        document.getElementById('userName').textContent = username;
        document.getElementById('userRole').textContent = currentUser.role;
        
        loadData();
        importCSVData().then(() => {
          updateDashboard();
          populateFilters();
        });
      } else {
        document.getElementById('loginError').classList.remove('hidden');
      }
    }

    function logout() {
      currentUser = null;
      document.getElementById('loginPage').classList.remove('hidden');
      document.getElementById('appPage').classList.add('hidden');
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      document.getElementById('loginError').classList.add('hidden');
    }

    function showPage(page) {
      document.getElementById('dashboardPage').classList.add('hidden');
      document.getElementById('participantsPage').classList.add('hidden');
      document.getElementById('vipPage').classList.add('hidden');
      document.getElementById('sportsPage').classList.add('hidden');
      document.getElementById('teamsPage').classList.add('hidden');
      document.getElementById('attendancePage').classList.add('hidden');
      document.getElementById('shieldsPage').classList.add('hidden');
      document.getElementById('shieldAssignmentPage').classList.add('hidden');
      document.getElementById('mcPage').classList.add('hidden');
      document.getElementById('eventdayPage').classList.add('hidden');
      document.getElementById('playersPage').classList.add('hidden');
      document.getElementById('participantPortalPage').classList.add('hidden');
      
      document.getElementById(page + 'Page').classList.remove('hidden');
      
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.getElementById('nav-' + page).classList.add('active');
      
      switch(page) {
        case 'dashboard': updateDashboard(); break;
        case 'participants': renderParticipants(); break;
        case 'vip': renderVip(); break;
        case 'sports': renderSports(); break;
        case 'teams': renderTeams(); break;
        case 'attendance': renderAttendance(); break;
        case 'shields': renderShields(); break;
        case 'shieldAssignment': renderGohSelectList(); break;
        case 'mc': renderMC(); break;
        case 'eventday': renderEventDay(); break;
        case 'players': 
          populatePlayerFilters();
          renderPlayersList(); 
          break;
        case 'participantPortal':
          document.getElementById('participantLoginCard').classList.remove('hidden');
          document.getElementById('participantDashboard').classList.add('hidden');
          currentParticipant = null;
          document.getElementById('participantEmail').value = '';
          document.getElementById('participantId').value = '';
          break;
      }
    }

    // Shield Assignment Functions
    function renderGohSelectList() {
      const list = document.getElementById('gohSelectList');
      list.innerHTML = vips.map(v => {
        const used = v.shields_given;
        const remaining = v.shield_budget - used;
        return `
          <div class="goh-select-item" onclick="selectGohForShield('${v.id}')" id="goh-select-${v.id}">
            <div class="goh-select-avatar">${v.name.charAt(0)}</div>
            <div class="goh-select-info">
              <div class="goh-select-name">#${v.ranking} ${v.name}</div>
              <div class="goh-select-org">${v.designation.substring(0, 30)}</div>
            </div>
            <div class="goh-select-budget">
              <div class="goh-budget-remaining" style="color: ${remaining > 0 ? '#4361ee' : '#dc2626'}">${remaining}</div>
              <div class="goh-budget-label">remaining</div>
              <div class="goh-budget-used">${used} used</div>
            </div>
          </div>
        `;
      }).join('');
    }

    let selectedGohId = null;
    let selectedParticipants = [];

    function selectGohForShield(gohId) {
      selectedGohId = gohId;
      selectedParticipants = [];
      
      // Update UI
      document.querySelectorAll('.goh-select-item').forEach(item => item.classList.remove('selected'));
      document.getElementById('goh-select-' + gohId).classList.add('selected');
      
      const goh = vips.find(v => v.id === gohId);
      const gohShields = shields.filter(s => s.awardedById === gohId);
      const used = goh.shields_given;
      const remaining = goh.shield_budget - used;
      const progressPercent = (used / goh.shield_budget) * 100;
      
      const content = document.getElementById('shieldAssignContent');
      content.innerHTML = `
        <div class="selected-goh-header">
          <div class="selected-goh-avatar">${goh.name.charAt(0)}</div>
          <div class="selected-goh-details">
            <h2>üèÜ ${goh.name}</h2>
            <p>${goh.designation} at ${goh.organization}</p>
            <div class="shield-progress-card">
              <div style="flex: 1;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; color: #666;">
                  <span>Shields Awarded</span>
                  <span>${used} / ${goh.shield_budget}</span>
                </div>
                <div class="shield-progress-bar">
                  <div class="shield-progress-fill" style="width: ${progressPercent}%"></div>
                </div>
              </div>
              <div class="shield-progress-text">
                <div style="font-size: 24px; font-weight: 700; color: ${remaining > 0 ? '#4361ee' : '#dc2626'}">${remaining}</div>
                <div style="font-size: 12px; color: #666;">Remaining</div>
              </div>
            </div>
          </div>
        </div>
        
        ${remaining > 0 ? `
        <div class="shield-assign-section">
          <h3>üë• Select Participants to Award Shields</h3>
          <div class="participant-select-grid" id="participantSelectGrid">
            ${participants.map(p => `
              <div class="participant-select-card" onclick="toggleParticipantSelect('${p.id}')" id="part-select-${p.id}">
                <input type="checkbox" ${selectedParticipants.includes(p.id) ? 'checked' : ''}>
                <div class="participant-select-info">
                  <div class="participant-select-name">${p.name}</div>
                  <div class="participant-select-org">${p.organization || 'N/A'}</div>
                  <div class="participant-select-sports">
                    ${p.sports.slice(0, 3).map(s => `<span class="participant-select-sport">${s}</span>`).join('')}
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
        
        <div class="award-form">
          <h3 style="margin-bottom: 16px; font-size: 16px; color: #1a1a2e;">üìù Award Details</h3>
          <div class="award-form-row">
            <div class="form-group">
              <label>Sport *</label>
              <select id="awardSport">
                <option value="">Select Sport</option>
                ${sports.map(s => `<option value="${s.name}">${s.icon || '‚öΩ'} ${s.name}</option>`).join('')}
                <option value="General">üèÖ General</option>
              </select>
            </div>
            <div class="form-group" style="flex: 2;">
              <label>Reason for Award *</label>
              <textarea id="awardReason" placeholder="Describe the achievement or reason for the shield award..."></textarea>
            </div>
          </div>
          <div style="margin-top: 16px;">
            <button class="btn" onclick="submitShieldAwards()" style="width: auto; padding: 12px 30px;" ${selectedParticipants.length === 0 ? 'disabled' : ''}>
              üõ°Ô∏è Award Shield${selectedParticipants.length > 1 ? 's' : ''} to ${selectedParticipants.length || 0} Participant${selectedParticipants.length !== 1 ? 's' : ''}
            </button>
          </div>
        </div>
        ` : `
        <div style="text-align: center; padding: 40px; background: #fee2e2; border-radius: 12px; margin-top: 20px;">
          <div style="font-size: 48px; margin-bottom: 10px;">‚ö†Ô∏è</div>
          <h3 style="color: #dc2626; margin-bottom: 8px;">No Shields Remaining</h3>
          <p style="color: #666;">${goh.name} has used all ${goh.shield_budget} shields from their budget.</p>
        </div>
        `}
        
        <div class="awarded-history">
          <h3>üìú Shield History - ${goh.name}</h3>
          ${gohShields.length > 0 ? gohShields.map(s => `
            <div class="awarded-item">
              <div style="font-size: 24px;">üèÜ</div>
              <div class="awarded-item-recipient">
                <div class="awarded-item-name">${s.recipient}</div>
                <div class="awarded-item-reason">${s.reason}</div>
              </div>
              <span class="awarded-item-sport">${s.sport || 'General'}</span>
              <div class="awarded-item-date">${s.date}</div>
              <div class="awarded-item-actions">
                <button class="btn-action btn-delete" onclick="deleteShield('${s.id}')" title="Revoke">üóëÔ∏è</button>
              </div>
            </div>
          `).join('') : `
          <div class="empty-history">
            <div class="empty-history-icon">üèÜ</div>
            <p>No shields awarded yet</p>
          </div>
          `}
        </div>
      `;
    }

    function toggleParticipantSelect(participantId) {
      const index = selectedParticipants.indexOf(participantId);
      if (index > -1) {
        selectedParticipants.splice(index, 1);
      } else {
        selectedParticipants.push(participantId);
      }
      
      const card = document.getElementById('part-select-' + participantId);
      const checkbox = card.querySelector('input[type="checkbox"]');
      card.classList.toggle('selected', selectedParticipants.includes(participantId));
      checkbox.checked = selectedParticipants.includes(participantId);
    }

    function submitShieldAwards() {
      const sport = document.getElementById('awardSport').value;
      const reason = document.getElementById('awardReason').value.trim();
      
      if (!sport) {
        alert('Please select a sport');
        return;
      }
      
      if (!reason) {
        alert('Please provide a reason for the award');
        return;
      }
      
      if (selectedParticipants.length === 0) {
        alert('Please select at least one participant');
        return;
      }
      
      const goh = vips.find(v => v.id === selectedGohId);
      if (!goh) {
        alert('GOH not found');
        return;
      }
      
      const remaining = goh.shield_budget - goh.shields_given;
      if (selectedParticipants.length > remaining) {
        alert(`Not enough shields remaining. You have ${remaining} shields left but selected ${selectedParticipants.length} participants.`);
        return;
      }
      
      const newShields = [];
      selectedParticipants.forEach(partId => {
        const participant = participants.find(p => p.id === partId);
        if (participant) {
          const newId = 'SH-' + String(shields.length + newShields.length + 1).padStart(4, '0');
          shields.push({
            id: newId,
            recipient: participant.name,
            recipientId: participant.id,
            awardedBy: goh.name,
            awardedById: goh.id,
            sport,
            reason,
            date: new Date().toISOString().split('T')[0]
          });
          newShields.push(participant.name);
        }
      });
      
      goh.shields_given += selectedParticipants.length;
      saveData();
      
      alert(`‚úÖ Successfully awarded shields to ${newShields.length} participant(s)!`);
      
      // Reset form and refresh
      selectedParticipants = [];
      document.getElementById('awardSport').value = '';
      document.getElementById('awardReason').value = '';
      
      renderShields();
      renderGohSelectList();
      selectGohForShield(selectedGohId);
      updateDashboard();
    }

    function updateDashboard() {
      document.getElementById('participantCount').textContent = participants.length;
      document.getElementById('vipCount').textContent = vips.length;
      document.getElementById('sportCount').textContent = sports.length;
      document.getElementById('shieldCount').textContent = shields.length;
      document.getElementById('teamCount').textContent = teams.length;
      
      const date = document.getElementById('attendanceDate').value;
      const dateAttendance = attendance[date] || { participants: {}, vip: {} };
      
      const partPresent = Object.values(dateAttendance.participants || {}).filter(s => s === 'Present').length;
      const vipPresent = Object.values(dateAttendance.vip || {}).filter(s => s === 'Present').length;
      
      const partRate = participants.length > 0 ? Math.round((partPresent / participants.length) * 100) : 0;
      const vipRate = vips.length > 0 ? Math.round((vipPresent / vips.length) * 100) : 0;
      
      document.getElementById('participantBar').style.width = partRate + '%';
      document.getElementById('participantRate').textContent = partRate + '%';
      document.getElementById('vipBar').style.width = vipRate + '%';
      document.getElementById('vipRate').textContent = vipRate + '%';
      document.getElementById('attendanceRate').textContent = vipRate + '%';
    }

    function populateFilters() {
      const sportFilter = document.getElementById('sportFilter');
      const teamSportFilter = document.getElementById('teamSportFilter');
      const teamSportSelect = document.getElementById('teamSport');
      
      sportFilter.innerHTML = '<option value="">All Sports</option>';
      teamSportFilter.innerHTML = '<option value="">All Sports</option>';
      teamSportSelect.innerHTML = '<option value="">Select Sport</option>';
      
      sports.forEach(s => {
        sportFilter.innerHTML += '<option value="' + s.name + '">' + s.name + '</option>';
        teamSportFilter.innerHTML += '<option value="' + s.name + '">' + s.name + '</option>';
        teamSportSelect.innerHTML += '<option value="' + s.name + '">' + s.name + '</option>';
      });
    }

    function populatePlayerFilters() {
      const playerSportFilter = document.getElementById('playerSportFilter');
      playerSportFilter.innerHTML = '<option value="">All Sports</option>';
      sports.forEach(s => {
        playerSportFilter.innerHTML += '<option value="' + s.name + '">' + s.name + '</option>';
      });
    }

    function filterParticipants() {
      renderParticipants();
    }

    function renderParticipants() {
      const search = document.getElementById('participantSearch').value.toLowerCase();
      const sportFilter = document.getElementById('sportFilter').value;
      
      const filtered = participants.filter(p => {
        const matchSearch = p.name.toLowerCase().includes(search) || p.organization.toLowerCase().includes(search);
        const matchSport = !sportFilter || p.sports.includes(sportFilter);
        return matchSearch && matchSport;
      });
      
      const tbody = document.getElementById('participantsTable');
      tbody.innerHTML = filtered.map(p => `
        <tr>
          <td><span class="badge">${p.id}</span></td>
          <td>${p.name}</td>
          <td>${p.designation}</td>
          <td>${p.organization}</td>
          <td>${p.phone}</td>
          <td>${p.sports.map(s => `<span class="sport-tag">${s}</span>`).join('')}</td>
          <td>
            <div class="action-btns">
              <button class="btn-action btn-delete" onclick="deleteParticipant('${p.id}')" title="Delete">üóëÔ∏è</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function filterVips() {
      renderVip();
    }

    function renderVip() {
      const search = document.getElementById('vipSearch').value.toLowerCase();
      
      const filtered = vips.filter(v => 
        v.name.toLowerCase().includes(search) || v.organization.toLowerCase().includes(search)
      );
      
      const grid = document.getElementById('vipGrid');
      grid.innerHTML = filtered.map(v => `
        <div class="vip-card">
          <div class="vip-ranking">#${v.ranking}</div>
          <div class="vip-avatar">${v.name.charAt(0)}</div>
          <h3>${v.name}</h3>
          <p class="vip-designation">${v.designation}</p>
          <p class="vip-org">${v.organization}</p>
          <div class="vip-stats">
            <span>Budget: ${v.shield_budget}</span>
            <span>Given: ${v.shields_given}</span>
          </div>
          <div style="display: flex; justify-content: center; gap: 8px; margin-top: 10px;">
            <span class="status-badge ${v.status.toLowerCase()}">${v.status}</span>
            <button class="btn-action btn-delete" onclick="deleteVip('${v.id}')" title="Delete">üóëÔ∏è</button>
          </div>
        </div>
      `).join('');
    }

    function renderSports() {
      document.getElementById('totalSports').textContent = sports.length;
      
      const grid = document.getElementById('sportsGrid');
      grid.innerHTML = sports.map(s => `
        <div class="sport-card" onclick="showSportParticipants('${s.name}')">
          <div class="sport-icon">${s.icon || '‚öΩ'}</div>
          <h4>${s.name}</h4>
          <p>${s.participants} Participants</p>
        </div>
      `).join('');
    }

    function showSportParticipants(sportName) {
      const sportParticipants = participants.filter(p => p.sports.includes(sportName));
      
      const content = document.getElementById('sportParticipantsContent');
      const sport = sports.find(s => s.name === sportName);
      
      content.innerHTML = `
        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid #e0e0e0;">
          <div style="font-size: 48px;">${sport?.icon || '‚öΩ'}</div>
          <div>
            <h2 style="font-size: 24px; color: #1a1a2e; margin-bottom: 4px;">${sportName}</h2>
            <p style="color: #666;">${sportParticipants.length} Participant${sportParticipants.length !== 1 ? 's' : ''} enrolled</p>
          </div>
        </div>
        
        ${sportParticipants.length > 0 ? `
          <div class="table-container">
            <div class="table-scroll" style="max-height: 400px; overflow-y: auto;">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Designation</th>
                    <th>Organization</th>
                    <th>Contact</th>
                    <th>Other Sports</th>
                  </tr>
                </thead>
                <tbody>
                  ${sportParticipants.map(p => `
                    <tr>
                      <td><span class="badge">${p.id}</span></td>
                      <td><strong>${p.name}</strong></td>
                      <td>${p.designation || '-'}</td>
                      <td>${p.organization || '-'}</td>
                      <td>${p.phone || '-'}</td>
                      <td>
                        ${p.sports.filter(s => s !== sportName).map(s => `<span class="sport-tag">${s}</span>`).join('') || '<span style="color: #999;">None</span>'}
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        ` : `
          <div class="empty-history">
            <div class="empty-history-icon">üë•</div>
            <p>No participants enrolled in ${sportName} yet</p>
          </div>
        `}
      `;
      
      document.getElementById('sportParticipantsModal').classList.remove('hidden');
    }

    function filterTeams() {
      renderTeams();
    }

    function renderTeams() {
      const sportFilter = document.getElementById('teamSportFilter').value;
      const playerFilter = document.getElementById('teamPlayerFilter').value;
      
      // Group teams by sport
      const teamsBySport = {};
      sports.forEach(s => {
        teamsBySport[s.name] = [];
      });
      
      teams.forEach(team => {
        if (!teamsBySport[team.sport]) {
          teamsBySport[team.sport] = [];
        }
        teamsBySport[team.sport].push(team);
      });
      
      // Filter teams
      let filteredSports = Object.keys(teamsBySport);
      if (sportFilter) {
        filteredSports = filteredSports.filter(s => s === sportFilter);
      }
      
      // Get teams with player filter
      let filteredTeams = [];
      if (playerFilter) {
        teams.forEach(t => {
          if (t.members.some(m => m.id === playerFilter)) {
            filteredTeams.push(t);
          }
        });
      }
      
      const container = document.getElementById('teamsBySport');
      
      if (teams.length === 0) {
        container.innerHTML = `
          <div class="no-teams-message">
            <div class="no-teams-message-icon">üë•</div>
            <h3>No Teams Created Yet</h3>
            <p>Create teams for different sports to organize your participants.</p>
            <button class="btn-primary" style="margin-top: 16px;" onclick="showCreateTeamModal()">+ Create First Team</button>
          </div>
        `;
        return;
      }
      
      let html = '';
      
      filteredSports.forEach(sportName => {
        const sportTeams = teamsBySport[sportName] || [];
        const sport = sports.find(s => s.name === sportName);
        const totalPlayers = new Set(sportTeams.flatMap(t => t.members.map(m => m.id))).size;
        
        if (sportFilter && sportTeams.length === 0) return;
        
        html += `
          <div class="sport-team-section">
            <div class="sport-team-header">
              <div class="sport-team-title">
                <span class="sport-team-icon">${sport?.icon || '‚öΩ'}</span>
                <div>
                  <div class="sport-team-name">${sportName}</div>
                  <div class="sport-team-count">${sportTeams.length} team${sportTeams.length !== 1 ? 's' : ''} ‚Ä¢ ${totalPlayers} unique players</div>
                </div>
              </div>
              <button class="btn-secondary btn-small" onclick="showAddPlayerToSport('${sportName}')">+ Add Player</button>
            </div>
        `;
        
        if (sportTeams.length === 0) {
          html += `<p style="color: #999; text-align: center; padding: 20px;">No teams for ${sportName} yet.</p>`;
        } else {
          sportTeams.forEach(team => {
            html += `
              <div style="background: #f8f9fa; border-radius: 10px; padding: 16px; margin-bottom: 12px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                  <div style="font-weight: 600; font-size: 15px; color: #1a1a2e;">${team.name}</div>
                  <div style="display: flex; gap: 8px;">
                    <button class="btn-action btn-delete" onclick="deleteTeam('${team.id}')" title="Delete Team">üóëÔ∏è</button>
                  </div>
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                  ${team.members.map(m => `
                    <div class="team-player-chip">
                      <div class="team-player-avatar">${m.name.charAt(0)}</div>
                      <div class="team-player-info">
                        <span class="team-player-name">${m.name}</span>
                        <span class="team-player-sports">${(m.sports || []).slice(0, 2).join(', ')}</span>
                      </div>
                      <span class="team-player-remove" onclick="removeFromTeam('${team.id}', '${m.id}')" title="Remove">&times;</span>
                    </div>
                  `).join('')}
                  <div class="team-player-add" onclick="showAddPlayerToTeam('${team.id}')">
                    <span>+</span>
                    <span>Add Player</span>
                  </div>
                </div>
              </div>
            `;
          });
        }
        
        html += `</div>`;
      });
      
      // Show filtered teams by player if filter is applied
      if (playerFilter && filteredTeams.length > 0) {
        const player = participants.find(p => p.id === playerFilter);
        html = `
          <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
            <h3 style="margin-bottom: 16px; color: #1a1a2e;">Teams with ${player?.name || 'Player'}</h3>
            ${filteredTeams.map(t => `
              <div style="background: #f8f9fa; border-radius: 10px; padding: 16px; margin-bottom: 12px;">
                <div style="font-weight: 600; font-size: 15px; color: #4361ee; margin-bottom: 8px;">${t.sport} - ${t.name}</div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                  ${t.members.map(m => `
                    <div class="team-player-chip" style="${m.id === playerFilter ? 'background: #d1fae5;' : ''}">
                      <div class="team-player-avatar">${m.name.charAt(0)}</div>
                      <div class="team-player-info">
                        <span class="team-player-name">${m.name}</span>
                      </div>
                      ${m.id !== playerFilter ? `<span class="team-player-remove" onclick="removeFromTeam('${t.id}', '${m.id}')">&times;</span>` : ''}
                    </div>
                  `).join('')}
                </div>
              </div>
            `).join('')}
          </div>
        ` + html;
      }
      
      container.innerHTML = html;
      
      // Update player filter dropdown
      const playerFilterSelect = document.getElementById('teamPlayerFilter');
      const currentPlayerFilter = playerFilterSelect.value;
      playerFilterSelect.innerHTML = '<option value="">All Players</option>';
      participants.forEach(p => {
        playerFilterSelect.innerHTML += `<option value="${p.id}">${p.name}</option>`;
      });
      playerFilterSelect.value = currentPlayerFilter;
    }

    function showCreateTeamModal() {
      const select = document.getElementById('teamMemberSelect');
      select.innerHTML = participants.map(p => `<option value="${p.id}">${p.name} (${p.sports.join(', ')})</option>`).join('');
      document.getElementById('createTeamModal').classList.remove('hidden');
    }

    function closeModal(id) {
      document.getElementById(id).classList.add('hidden');
    }

    function createTeam() {
      const name = document.getElementById('teamName').value;
      const sport = document.getElementById('teamSport').value;
      const select = document.getElementById('teamMemberSelect');
      const selectedIds = Array.from(select.selectedOptions).map(o => o.value);
      
      if (!name || !sport || selectedIds.length === 0) {
        alert('Please fill all fields and select at least one member');
        return;
      }
      
      const members = selectedIds.map(id => participants.find(p => p.id === id)).filter(Boolean);
      
      teams.push({
        id: 'T-' + String(teams.length + 1).padStart(3, '0'),
        name,
        sport,
        members
      });
      
      saveData();
      closeModal('createTeamModal');
      renderTeams();
      updateDashboard();
      
      document.getElementById('teamName').value = '';
      document.getElementById('teamSport').value = '';
    }

    function removeFromTeam(teamId, memberId) {
      const team = teams.find(t => t.id === teamId);
      if (team) {
        team.members = team.members.filter(m => m.id !== memberId);
        saveData();
        renderTeams();
      }
    }

    let currentEditingTeamId = null;
    let currentAddingToSport = null;

    function showAddPlayerToTeam(teamId) {
      currentEditingTeamId = teamId;
      const team = teams.find(t => t.id === teamId);
      if (!team) return;
      
      const existingMemberIds = new Set(team.members.map(m => m.id));
      const availableParticipants = participants.filter(p => !existingMemberIds.has(p.id));
      
      document.getElementById('addPlayerModalTitle').textContent = 'Add Players to ' + team.name;
      document.getElementById('addPlayerModalSubtitle').textContent = 'Select players to add to this ' + team.sport + ' team';
      document.getElementById('addPlayerList').innerHTML = availableParticipants.length > 0 ? availableParticipants.map(p => `
        <div class="add-player-option" onclick="togglePlayerSelection('${p.id}', this)">
          <input type="checkbox" value="${p.id}">
          <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #4361ee, #7209b7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px;">
            ${p.name.charAt(0)}
          </div>
          <div>
            <div style="font-weight: 600; font-size: 14px; color: #1a1a2e;">${p.name}</div>
            <div style="font-size: 11px; color: #666;">${p.organization || 'N/A'}</div>
            <div style="display: flex; gap: 4px; margin-top: 4px;">
              ${p.sports.slice(0, 3).map(s => `<span style="background: #eef2ff; color: #4361ee; padding: 2px 6px; border-radius: 4px; font-size: 10px;">${s}</span>`).join('')}
            </div>
          </div>
        </div>
      `).join('') : '<p style="color: #999; text-align: center; padding: 20px;">No available participants to add</p>';
      
      document.getElementById('addPlayerToTeamModal').classList.remove('hidden');
    }

    function showAddPlayerToSport(sportName) {
      currentAddingToSport = sportName;
      currentEditingTeamId = null;
      
      document.getElementById('addPlayerModalTitle').textContent = 'Create New Team for ' + sportName;
      document.getElementById('addPlayerModalSubtitle').textContent = 'Select players to add to your new team';
      document.getElementById('addPlayerList').innerHTML = participants.map(p => `
        <div class="add-player-option" onclick="togglePlayerSelection('${p.id}', this)">
          <input type="checkbox" value="${p.id}">
          <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #4361ee, #7209b7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px;">
            ${p.name.charAt(0)}
          </div>
          <div>
            <div style="font-weight: 600; font-size: 14px; color: #1a1a2e;">${p.name}</div>
            <div style="font-size: 11px; color: #666;">${p.organization || 'N/A'}</div>
            <div style="display: flex; gap: 4px; margin-top: 4px;">
              ${p.sports.slice(0, 3).map(s => `<span style="background: #eef2ff; color: #4361ee; padding: 2px 6px; border-radius: 4px; font-size: 10px;">${s}</span>`).join('')}
            </div>
          </div>
        </div>
      `).join('');
      
      document.getElementById('addPlayerToTeamModal').classList.remove('hidden');
    }

    function togglePlayerSelection(playerId, element) {
      const checkbox = element.querySelector('input[type="checkbox"]');
      checkbox.checked = !checkbox.checked;
      element.classList.toggle('selected', checkbox.checked);
    }

    function saveAddedPlayers() {
      const selectedCheckboxes = document.querySelectorAll('#addPlayerList input[type="checkbox"]:checked');
      const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
      
      if (selectedIds.length === 0) {
        alert('Please select at least one player');
        return;
      }
      
      const selectedMembers = selectedIds.map(id => participants.find(p => p.id === id)).filter(Boolean);
      
      if (currentEditingTeamId) {
        // Add to existing team
        const team = teams.find(t => t.id === currentEditingTeamId);
        if (team) {
          team.members.push(...selectedMembers);
          saveData();
          closeModal('addPlayerToTeamModal');
          renderTeams();
        }
      } else if (currentAddingToSport) {
        // Create new team for sport
        const teamName = prompt('Enter team name for ' + currentAddingToSport + ':');
        if (!teamName) return;
        
        teams.push({
          id: 'T-' + String(teams.length + 1).padStart(3, '0'),
          name: teamName,
          sport: currentAddingToSport,
          members: selectedMembers
        });
        
        saveData();
        closeModal('addPlayerToTeamModal');
        renderTeams();
        updateDashboard();
      }
    }

    function deleteTeam(teamId) {
      if (!confirm('Are you sure you want to delete this team? This action cannot be undone.')) return;
      
      teams = teams.filter(t => t.id !== teamId);
      saveData();
      renderTeams();
      updateDashboard();
    }

    function renderAttendance() {
      const date = document.getElementById('attendanceDate').value;
      const dateAttendance = attendance[date] || { participants: {}, vip: {} };
      
      const partPresent = Object.values(dateAttendance.participants || {}).filter(s => s === 'Present').length;
      const vipPresent = Object.values(dateAttendance.vip || {}).filter(s => s === 'Present').length;

      document.getElementById('participantPresent').textContent = partPresent;
      document.getElementById('participantTotal').textContent = participants.length;
      document.getElementById('vipPresent').textContent = vipPresent;
      document.getElementById('vipTotal').textContent = vips.length;

      const partHTML = participants.map(p => {
        const status = dateAttendance.participants[p.id] || '';
        return `
          <div class="attendance-item ${status.toLowerCase()}">
            <div class="item-info">
              <span class="item-id">${p.id}</span>
              <span class="item-name">${p.name}</span>
            </div>
            <div class="item-actions">
              <button class="status-btn present ${status === 'Present' ? 'active' : ''}" onclick="markAttendance('participants', '${p.id}')">Present</button>
              <button class="status-btn absent ${status === 'Absent' ? 'active' : ''}" onclick="markAttendance('participants', '${p.id}', 'Absent')">Absent</button>
            </div>
          </div>
        `;
      }).join('');
      document.getElementById('participantAttendance').innerHTML = partHTML;

      const vipHTML = vips.map(v => {
        const status = dateAttendance.vip[v.id] || '';
        return `
          <div class="attendance-item ${status.toLowerCase()}">
            <div class="item-info">
              <span class="item-id">${v.id}</span>
              <span class="item-name">${v.name}</span>
              <span style="color:#666;font-size:12px;margin-left:8px;">#${v.ranking}</span>
            </div>
            <div class="item-actions">
              <button class="status-btn present ${status === 'Present' ? 'active' : ''}" onclick="markAttendance('vip', '${v.id}')">Present</button>
              <button class="status-btn absent ${status === 'Absent' ? 'active' : ''}" onclick="markAttendance('vip', '${v.id}', 'Absent')">Absent</button>
            </div>
          </div>
        `;
      }).join('');
      document.getElementById('vipAttendance').innerHTML = vipHTML;
    }

    function markAttendance(type, id, status = 'Present') {
      const date = document.getElementById('attendanceDate').value;
      
      if (!attendance[date]) {
        attendance[date] = { participants: {}, vip: {} };
      }
      attendance[date][type][id] = status;
      
      localStorage.setItem('attendance', JSON.stringify(attendance));
      renderAttendance();
      updateDashboard();
    }

    function renderShields() {
      const tbody = document.getElementById('shieldsTable');
      tbody.innerHTML = shields.map(s => `
        <tr>
          <td><span style="background:linear-gradient(135deg,#ffd700,#ffb700);color:#1a1a2e;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;">${s.id}</span></td>
          <td>${s.recipient} <span class="badge" style="font-size:10px;">${s.recipientId}</span></td>
          <td>${s.awardedBy}</td>
          <td><span class="sport-tag">${s.sport || 'General'}</span></td>
          <td>${s.reason}</td>
          <td>${s.date}</td>
          <td>
            <div class="action-btns">
              <button class="btn-action btn-delete" onclick="deleteShield('${s.id}')" title="Delete">üóëÔ∏è</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function awardShield() {
      const availableVips = vips.filter(v => v.shields_given < v.shield_budget);
      if (availableVips.length === 0) {
        alert('No VIP has remaining shield budget!'); return;
      }
      
      const vipOptions = availableVips.map(v => `${v.id}. ${v.name} (${v.shields_given}/${v.shield_budget})`).join('\n');
      const selectedVipId = prompt('Select VIP:\n' + vipOptions + '\n\nEnter VIP ID (e.g., V-001):');
      const selectedVip = vips.find(v => v.id === selectedVipId);
      
      if (!selectedVip) { alert('Invalid VIP selection'); return; }
      
      const partOptions = participants.map(p => `${p.id}. ${p.name}`).join('\n');
      const selectedPartId = prompt('Select Participant:\n' + partOptions + '\n\nEnter Participant ID (e.g., P-0001):');
      const selectedPart = participants.find(p => p.id === selectedPartId);
      
      if (!selectedPart) { alert('Invalid participant selection'); return; }
      
      const sportOptions = ['General', ...sports.map(s => s.name)].join('\n');
      const selectedSport = prompt('Select Sport:\n' + sportOptions + '\n\nEnter sport name:');
      
      const reason = prompt('Reason for award:');
      if (reason) {
        const newId = 'SH-' + String(shields.length + 1).padStart(4, '0');
        shields.push({
          id: newId,
          recipient: selectedPart.name,
          recipientId: selectedPart.id,
          awardedBy: selectedVip.name,
          awardedById: selectedVip.id,
          sport: selectedSport || 'General',
          reason,
          date: new Date().toISOString().split('T')[0]
        });
        selectedVip.shields_given++;
        saveData();
        renderShields();
        updateDashboard();
      }
    }

    function renderMC() {
      const list = document.getElementById('mcVipList');
      list.innerHTML = vips.sort((a, b) => a.ranking - b.ranking).slice(0, 10).map(v => {
        const shieldCount = shields.filter(s => s.awardedById === v.id).length;
        return `
          <div class="vip-item" onclick="showVipAssignments('${v.id}', this)">
            <div class="vip-ranking" style="background:#4361ee;color:white;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:11px;">${v.ranking}</div>
            <div style="flex:1;min-width:0;">
              <div style="font-weight:600;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${v.name}</div>
            </div>
            <div style="text-align:center;min-width:36px;">
              <div style="font-size:16px;font-weight:700;color:#4361ee;">${shieldCount}</div>
            </div>
          </div>
        `;
      }).join('');

      const partShieldCounts = participants.map(p => ({ ...p, count: shields.filter(s => s.recipientId === p.id).length }));
      partShieldCounts.sort((a, b) => b.count - a.count);
      
      document.getElementById('topRecipients').innerHTML = partShieldCounts.slice(0, 5).map((p, i) => `
        <div style="display:flex;align-items:center;gap:10px;padding:10px;background:#f8f9fa;border-radius:8px;margin-bottom:8px;">
          <span style="width:24px;font-weight:700;color:#4361ee;">#${i + 1}</span>
          <span style="flex:1;font-weight:500;font-size:13px;">${p.name}</span>
          <span style="font-weight:700;color:#ffd700;font-size:16px;">${p.count}</span>
        </div>
      `).join('');
    }

    function showVipAssignments(vipId, element) {
      document.querySelectorAll('.vip-item').forEach(i => i.classList.remove('selected'));
      element.classList.add('selected');

      const v = vips.find(v => v.id === vipId);
      const vShields = shields.filter(s => s.awardedById === vipId);

      document.getElementById('mcAssignments').innerHTML = `
        <div style="padding:10px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
            <h3 style="font-size:16px;">üèÜ ${v.name}</h3>
            <span style="background:#4361ee;color:white;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;">Rank #${v.ranking}</span>
          </div>
          <div style="margin-bottom:16px;">
            <div style="height:8px;background:#e0e0e0;border-radius:4px;overflow:hidden;margin-bottom:8px;">
              <div style="height:100%;background:linear-gradient(90deg,#4361ee,#7209b7);border-radius:4px;width:${(vShields.length / v.shield_budget) * 100}%"></div>
            </div>
            <span style="font-size:12px;color:#666;">${vShields.length} / ${v.shield_budget} shields given</span>
          </div>
          <h4 style="font-size:13px;color:#666;margin-bottom:10px;">Awarded To:</h4>
          ${vShields.length > 0 ? vShields.map(s => `
            <div style="background:#f8f9fa;padding:10px;border-radius:8px;border-left:3px solid #ffd700;margin-bottom:8px;">
              <div style="font-weight:600;font-size:13px;">${s.recipient}</div>
              <div style="font-size:11px;color:#4361ee;">${s.sport || 'General'} - ${s.reason}</div>
            </div>
          `).join('') : '<p style="color:#999;font-style:italic;font-size:13px;">No shields awarded yet</p>'}
        </div>
      `;
    }

    // Event Day Functions
    document.getElementById('eventDayDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('eventDayDate').addEventListener('change', renderEventDay);

    function renderEventDay() {
      const date = document.getElementById('eventDayDate').value;
      const dateAttendance = attendance[date] || { participants: {}, vip: {} };
      
      // Get present participants
      const presentParticipants = participants.filter(p => dateAttendance.participants[p.id] === 'Present');
      const presentVips = vips.filter(v => dateAttendance.vip[v.id] === 'Present');
      
      // Update stats
      document.getElementById('eventPartCount').textContent = presentParticipants.length;
      document.getElementById('eventGohCount').textContent = presentVips.length;
      document.getElementById('eventTeamCount').textContent = teams.length;
      
      // Render present list
      const presentList = document.getElementById('eventPresentList');
      presentList.innerHTML = '';
      
      // Add GOH section
      if (presentVips.length > 0) {
        presentList.innerHTML += `
          <div style="margin-bottom: 20px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 8px; font-weight: 600;">‚≠ê GUESTS OF HONOR</div>
            ${presentVips.map(v => `
              <div class="event-present-item" style="border-left-color: #f59e0b;">
                <div class="event-present-avatar" style="background: linear-gradient(135deg, #f59e0b, #d97706);">${v.name.charAt(0)}</div>
                <div class="event-present-info">
                  <div class="event-present-name">#${v.ranking} ${v.name}</div>
                  <div class="event-present-org">${v.designation.substring(0, 25)}</div>
                </div>
                <span class="event-present-status">Present</span>
              </div>
            `).join('')}
          </div>
        `;
      }
      
      // Add Participants section
      if (presentParticipants.length > 0) {
        presentList.innerHTML += `
          <div>
            <div style="font-size: 12px; color: #666; margin-bottom: 8px; font-weight: 600;">üë• PARTICIPANTS</div>
            ${presentParticipants.map(p => `
              <div class="event-present-item">
                <div class="event-present-avatar">${p.name.charAt(0)}</div>
                <div class="event-present-info">
                  <div class="event-present-name">${p.name}</div>
                  <div class="event-present-org">${p.organization?.substring(0, 25) || 'N/A'}</div>
                </div>
                <span class="event-present-status">Present</span>
              </div>
            `).join('')}
          </div>
        `;
      }
      
      if (presentParticipants.length === 0 && presentVips.length === 0) {
        presentList.innerHTML = `
          <div class="event-no-data">
            <div class="event-no-data-icon">üìÖ</div>
            <h3>No One Present</h3>
            <p>No participants or GOH marked present for this date</p>
          </div>
        `;
      }
      
      // Render main content - Sports and Teams
      const content = document.getElementById('eventDayContent');
      
      if (teams.length === 0 && presentParticipants.length === 0) {
        content.innerHTML = `
          <div class="event-no-data">
            <div class="event-no-data-icon">üèÜ</div>
            <h3>No Event Data</h3>
            <p>No teams created or participants present for this event day</p>
          </div>
        `;
        return;
      }
      
      let html = '';
      
      // Present GOH Section
      if (presentVips.length > 0) {
        html += `
          <div class="event-goh-section">
            <div class="event-goh-title">
              <span class="event-goh-icon">‚≠ê</span>
              <span class="event-goh-name">Guests of Honor Present</span>
            </div>
            <div class="event-goh-grid">
              ${presentVips.map(v => `
                <div class="event-goh-chip">
                  <div class="event-goh-chip-avatar">${v.name.charAt(0)}</div>
                  <div>
                    <div style="font-weight: 600; font-size: 13px;">${v.name}</div>
                    <div style="font-size: 10px; color: #666;">#${v.ranking} ‚Ä¢ ${v.organization?.substring(0, 20) || ''}</div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      
      // Sports with Teams and Present Players
      sports.forEach(sport => {
        const sportTeams = teams.filter(t => t.sport === sport.name);
        const presentPlayersInSport = presentParticipants.filter(p => p.sports.includes(sport.name));
        
        if (sportTeams.length === 0 && presentPlayersInSport.length === 0) return;
        
        const sportIcon = sportIcons[sport.name] || '‚öΩ';
        
        html += `
          <div class="event-sport-section">
            <div class="event-sport-header">
              <div class="event-sport-title">
                <span class="event-sport-icon">${sportIcon}</span>
                <div>
                  <div class="event-sport-name">${sport.name}</div>
                  <div class="event-sport-count">${sportTeams.length} team${sportTeams.length !== 1 ? 's' : ''} ‚Ä¢ ${presentPlayersInSport.length} present</div>
                </div>
              </div>
            </div>
        `;
        
        if (sportTeams.length > 0) {
          html += '<div class="event-team-grid">';
          
          sportTeams.forEach(team => {
            const presentMembers = team.members.filter(m => presentParticipants.some(p => p.id === m.id));
            const allMembers = team.members;
            
            html += `
              <div class="event-team-card">
                <div class="event-team-header">
                  <div class="event-team-name">${team.name}</div>
                  <span style="font-size: 11px; background: ${presentMembers.length > 0 ? '#d1fae5' : '#f3e8ff'}; color: ${presentMembers.length > 0 ? '#059669' : '#7c3aed'}; padding: 2px 8px; border-radius: 10px;">
                    ${presentMembers.length}/${allMembers.length} present
                  </span>
                </div>
                <div class="event-team-members">
                  ${allMembers.map(m => {
                    const isPresent = presentParticipants.some(p => p.id === m.id);
                    return `
                      <div class="event-team-member" style="${isPresent ? 'background: #d1fae5;' : ''}">
                        <div class="event-team-member-avatar" style="${isPresent ? 'background: linear-gradient(135deg, #059669, #047857);' : ''}">${m.name.charAt(0)}</div>
                        <span style="${isPresent ? 'color: #059669; font-weight: 600;' : ''}">${m.name}</span>
                      </div>
                    `;
                  }).join('')}
                </div>
              </div>
            `;
          });
          
          html += '</div>';
        } else if (presentPlayersInSport.length > 0) {
          html += `
            <div style="padding: 10px; background: white; border-radius: 8px; margin-bottom: 12px;">
              <div style="font-size: 13px; color: #666; margin-bottom: 10px;">Present Participants (No teams):</div>
              <div class="event-team-members">
                ${presentPlayersInSport.map(p => `
                  <div class="event-team-member" style="background: #d1fae5;">
                    <div class="event-team-member-avatar" style="background: linear-gradient(135deg, #059669, #047857);">${p.name.charAt(0)}</div>
                    <span style="color: #059669; font-weight: 600;">${p.name}</span>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
        
        html += '</div>';
      });
      
      // Show present participants not in any team
      const participantsInTeams = new Set(teams.flatMap(t => t.members.map(m => m.id)));
      const presentNotInTeams = presentParticipants.filter(p => !participantsInTeams.has(p.id));
      
      if (presentNotInTeams.length > 0) {
        html += `
          <div class="event-sport-section" style="border: 2px dashed #e0e0e0;">
            <div class="event-sport-header">
              <div class="event-sport-title">
                <span class="event-sport-icon">üë•</span>
                <div>
                  <div class="event-sport-name">Present - Not in Teams</div>
                  <div class="event-sport-count">${presentNotInTeams.length} participant${presentNotInTeams.length !== 1 ? 's' : ''}</div>
                </div>
              </div>
            </div>
            <div class="event-team-members">
              ${presentNotInTeams.map(p => `
                <div class="event-team-member" style="background: #d1fae5;">
                  <div class="event-team-member-avatar" style="background: linear-gradient(135deg, #059669, #047857);">${p.name.charAt(0)}</div>
                  <span style="color: #059669; font-weight: 600;">${p.name}</span>
                  ${p.sports.slice(0, 2).map(s => `<span style="font-size: 10px; color: #666; margin-left: 4px;">${s}</span>`).join('')}
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      
      content.innerHTML = html;
    }

    // Players Page Functions
    let selectedPlayerId = null;

    function renderPlayersList() {
      const search = document.getElementById('playerSearch').value.toLowerCase();
      const sportFilter = document.getElementById('playerSportFilter').value;
      
      const filtered = participants.filter(p => {
        const matchSearch = p.name.toLowerCase().includes(search) || p.organization?.toLowerCase().includes(search);
        const matchSport = !sportFilter || p.sports.includes(sportFilter);
        return matchSearch && matchSport;
      });
      
      const list = document.getElementById('playerList');
      list.innerHTML = filtered.map(p => `
        <div class="player-list-item ${selectedPlayerId === p.id ? 'selected' : ''}" onclick="selectPlayer('${p.id}')">
          <div class="player-list-avatar">${p.name.charAt(0)}</div>
          <div class="player-list-info">
            <div class="player-list-name">${p.name}</div>
            <div class="player-list-org">${p.organization || 'N/A'}</div>
            <div class="player-list-sports">
              ${p.sports.slice(0, 3).map(s => `<span class="player-list-sport">${sportIcons[s] || '‚öΩ'} ${s}</span>`).join('')}
              ${p.sports.length > 3 ? `<span class="player-list-sport">+${p.sports.length - 3}</span>` : ''}
            </div>
          </div>
        </div>
      `).join('');
      
      if (filtered.length === 0) {
        list.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No players found</p>';
      }
    }

    function selectPlayer(playerId) {
      selectedPlayerId = playerId;
      renderPlayersList();
      renderPlayerDetail(playerId);
    }

    function renderPlayerDetail(playerId) {
      const player = participants.find(p => p.id === playerId);
      if (!player) return;
      
      // Get teams player belongs to
      const playerTeams = teams.filter(t => t.members.some(m => m.id === playerId));
      
      // Get shields awarded to player
      const playerShields = shields.filter(s => s.recipientId === playerId);
      
      // Get attendance history (last 10 days)
      const attendanceDates = Object.keys(attendance).sort().slice(-10);
      const recentAttendance = attendanceDates.map(date => {
        const status = attendance[date]?.participants?.[playerId] || 'Absent';
        return { date, status };
      }).filter(a => a.status !== undefined);
      
      const panel = document.getElementById('playerDetailPanel');
      panel.innerHTML = `
        <div class="player-detail-header">
          <div class="player-detail-avatar">${player.name.charAt(0)}</div>
          <div class="player-detail-name">${player.name}</div>
          <div class="player-detail-designation">${player.designation || 'No Designation'}</div>
          <div class="player-detail-org">${player.organization || 'No Organization'}</div>
          <div class="player-detail-contact">
            ${player.phone ? `<span>üì± ${player.phone}</span>` : ''}
            ${player.email ? `<span>üìß ${player.email}</span>` : ''}
          </div>
        </div>
        
        <div class="player-detail-section">
          <h4>üèÖ Sports Enrolled</h4>
          <div class="player-sports-grid">
            ${player.sports.map(s => `
              <div class="player-sport-chip">
                <span class="player-sport-icon">${sportIcons[s] || '‚öΩ'}</span>
                <span>${s}</span>
              </div>
            `).join('')}
          </div>
        </div>
        
        ${playerTeams.length > 0 ? `
          <div class="player-detail-section">
            <h4>üë• Teams (${playerTeams.length})</h4>
            ${playerTeams.map(t => `
              <div class="player-team-item">
                <div class="player-team-info">
                  <div class="player-team-name">${t.name}</div>
                  <div class="player-team-sport">${sportIcons[t.sport] || '‚öΩ'} ${t.sport}</div>
                </div>
                <div class="player-team-members">${t.members.length} members</div>
              </div>
            `).join('')}
          </div>
        ` : ''}
        
        ${playerShields.length > 0 ? `
          <div class="player-detail-section">
            <h4>üèÜ Shields Awarded (${playerShields.length})</h4>
            ${playerShields.map(s => `
              <div class="player-shield-item">
                <div class="player-shield-icon">üèÜ</div>
                <div class="player-shield-info">
                  <div class="player-shield-awardedby">Awarded by ${s.awardedBy}</div>
                  <div class="player-shield-reason">${s.sport || 'General'} - ${s.reason}</div>
                </div>
                <div class="player-shield-date">${s.date}</div>
              </div>
            `).join('')}
          </div>
        ` : ''}
        
        ${recentAttendance.length > 0 ? `
          <div class="player-detail-section">
            <h4>üìã Recent Attendance</h4>
            ${recentAttendance.slice().reverse().map(a => `
              <div class="player-attendance-item">
                <span class="player-attendance-date">${a.date}</span>
                <span class="player-attendance-status ${a.status.toLowerCase()}">${a.status}</span>
              </div>
            `).join('')}
          </div>
        ` : ''}
        
        <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid #e0e0e0; font-size: 12px; color: #999; text-align: center;">
          Player ID: ${player.id}
        </div>
      `;
    }

    // Participant Portal Functions
    let currentParticipant = null;

    document.getElementById('participantAttendanceDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('participantAttendanceDate').addEventListener('change', checkMyAttendance);

    function participantLogin() {
      const email = document.getElementById('participantEmail').value.trim().toLowerCase();
      const id = document.getElementById('participantId').value.trim();
      
      let participant = null;
      
      if (email) {
        participant = participants.find(p => p.email?.toLowerCase() === email);
      }
      
      if (!participant && id) {
        participant = participants.find(p => p.id === id);
      }
      
      if (!participant) {
        alert('Participant not found! Please check your email or ID.');
        return;
      }
      
      currentParticipant = participant;
      
      // Show dashboard
      document.getElementById('participantLoginCard').classList.add('hidden');
      document.getElementById('participantDashboard').classList.remove('hidden');
      
      // Update participant info
      document.getElementById('participantAvatar').textContent = participant.name.charAt(0);
      document.getElementById('participantName').textContent = participant.name;
      document.getElementById('participantOrg').textContent = participant.organization || 'No Organization';
      
      // Show sports
      document.getElementById('participantSports').innerHTML = participant.sports.map(s => `
        <div class="participant-sport-chip">
          <span class="icon">${sportIcons[s] || '‚öΩ'}</span>
          <span>${s}</span>
        </div>
      `).join('');
      
      // Check attendance for today
      checkMyAttendance();
      renderMyAttendanceHistory();
    }

    function participantLogout() {
      currentParticipant = null;
      document.getElementById('participantEmail').value = '';
      document.getElementById('participantId').value = '';
      document.getElementById('participantLoginCard').classList.remove('hidden');
      document.getElementById('participantDashboard').classList.add('hidden');
    }

    function checkMyAttendance() {
      if (!currentParticipant) return;
      
      const date = document.getElementById('participantAttendanceDate').value;
      const dateAttendance = attendance[date] || { participants: {} };
      const status = dateAttendance.participants[currentParticipant.id];
      
      const statusEl = document.getElementById('attendanceStatus');
      
      if (status === 'Present') {
        statusEl.className = 'attendance-status-display present';
        statusEl.innerHTML = '‚úÖ You are marked as <strong>PRESENT</strong> for ' + date;
      } else if (status === 'Absent') {
        statusEl.className = 'attendance-status-display absent';
        statusEl.innerHTML = '‚ùå You are marked as <strong>ABSENT</strong> for ' + date;
      } else {
        statusEl.className = 'attendance-status-display pending';
        statusEl.innerHTML = '‚ö™ Attendance not marked for ' + date;
      }
    }

    function markMyAttendance(status) {
      if (!currentParticipant) return;
      
      const date = document.getElementById('participantAttendanceDate').value;
      
      if (!attendance[date]) {
        attendance[date] = { participants: {}, vip: {} };
      }
      
      attendance[date].participants[currentParticipant.id] = status;
      
      // Save to localStorage
      localStorage.setItem('attendance', JSON.stringify(attendance));
      
      // Notify other tabs
      window.localStorage.setItem('attendanceUpdated', new Date().toISOString());
      
      alert('‚úÖ Attendance marked as ' + status + ' for ' + date);
      
      checkMyAttendance();
      renderMyAttendanceHistory();
      
      // Refresh main app if on same page
      if (document.getElementById('attendancePage').classList.contains('hidden') === false) {
        renderAttendance();
        updateDashboard();
      }
    }

    function renderMyAttendanceHistory() {
      if (!currentParticipant) return;
      
      const dates = Object.keys(attendance).sort().slice(-30); // Last 30 days
      
      const history = dates.map(date => {
        const status = attendance[date]?.participants?.[currentParticipant.id];
        if (status) {
          return { date, status };
        }
        return null;
      }).filter(Boolean).reverse();
      
      document.getElementById('participantAttendanceHistory').innerHTML = history.length > 0 ? history.map(h => `
        <div class="history-item">
          <span class="history-date">${h.date}</span>
          <span class="history-status ${h.status.toLowerCase()}">${h.status}</span>
        </div>
      `).join('') : '<p style="color: #999; text-align: center; padding: 20px;">No attendance history yet</p>';
    }

    // Listen for attendance updates from other tabs
    window.addEventListener('storage', function(e) {
      if (e.key === 'attendanceUpdated') {
        // Attendance was updated in another tab, refresh data
        if (document.getElementById('attendancePage').classList.contains('hidden') === false) {
          renderAttendance();
          updateDashboard();
        }
        if (document.getElementById('eventdayPage').classList.contains('hidden') === false) {
          renderEventDay();
        }
        // Refresh participant portal if open
        if (currentParticipant) {
          checkMyAttendance();
          renderMyAttendanceHistory();
        }
      }
    });

    // Bulk Upload Functions
    function handleParticipantCsvUpload(input) {
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result;
        const lines = text.split('\n').slice(1); // Skip header
        
        let added = 0;
        let skipped = 0;
        const errors = [];
        
        lines.forEach((line, index) => {
          if (line.trim()) {
            try {
              const cols = parseCSVLine(line);
              
              if (cols.length >= 7 && cols[1] && cols[6]) {
                const name = cols[1].trim();
                const email = cols[6].trim();
                const org = cols[3] ? cols[3].trim() : '';
                const desig = cols[2] ? cols[2].trim() : '';
                const phone = cols[5] ? cols[5].trim() : '';
                const sportsStr = cols[9] || '';
                const sportsList = sportsStr.replace(/"/g, '').split(',').map(s => s.trim()).filter(s => s && s !== 'NO' && s !== 'No' && s !== 'no');
                
                if (name && email) {
                  const existing = participants.find(p => p.email === email);
                  if (!existing) {
                    participants.push({
                      id: 'P-' + String(participants.length + 1).padStart(4, '0'),
                      name,
                      designation: desig,
                      organization: org,
                      phone,
                      email,
                      sports: sportsList
                    });
                    added++;
                  } else {
                    skipped++;
                  }
                }
              }
            } catch (err) {
              errors.push('Line ' + (index + 1) + ': ' + err.message);
            }
          }
        });
        
        saveData();
        updateDashboard();
        populateFilters();
        
        showBulkUploadResults('Participants', added, skipped, errors);
        input.value = '';
      };
      reader.readAsText(file);
    }

    function handleVipCsvUpload(input) {
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result;
        const lines = text.split('\n').slice(2); // Skip headers
        
        let added = 0;
        let skipped = 0;
        const errors = [];
        
        lines.forEach((line, index) => {
          if (line.trim() && !line.includes('Specific Names') && !line.includes('I. Specific')) {
            try {
              const cols = parseCSVLine(line);
              
              if (cols.length >= 4 && cols[1] && cols[1] !== 'Name / Targeted Role' && !isNaN(parseInt(cols[0]))) {
                const name = cols[1].trim();
                const existing = vips.find(v => v.name === name);
                
                if (!existing) {
                  const ranking = vips.length > 0 ? Math.max(...vips.map(v => v.ranking)) + 1 : 1;
                  vips.push({
                    id: 'V-' + String(ranking).padStart(3, '0'),
                    name,
                    designation: cols[2] ? cols[2].trim() : '',
                    organization: cols[3] ? cols[3].trim() : '',
                    ranking,
                    status: 'Active',
                    shields_given: 0,
                    shield_budget: 5
                  });
                  added++;
                } else {
                  skipped++;
                }
              }
            } catch (err) {
              errors.push('Line ' + (index + 1) + ': ' + err.message);
            }
          }
        });
        
        saveData();
        updateDashboard();
        
        showBulkUploadResults('VIP / GOH', added, skipped, errors);
        input.value = '';
      };
      reader.readAsText(file);
    }

    function parseCSVLine(line) {
      const result = [];
      let current = '';
      let inQuotes = false;
      
      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
          result.push(current);
          current = '';
        } else {
          current += char;
        }
      }
      result.push(current);
      return result;
    }

    function showBulkUploadResults(type, added, skipped, errors) {
      let html = `
        <div style="text-align: center; padding: 20px;">
          <div style="font-size: 48px; margin-bottom: 16px;">üìä</div>
          <h3 style="margin-bottom: 16px;">${type} Bulk Upload Complete</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
            <div style="background: #d1fae5; padding: 16px; border-radius: 8px;">
              <div style="font-size: 28px; font-weight: 700; color: #059669;">${added}</div>
              <div style="font-size: 13px; color: #059669;">Added</div>
            </div>
            <div style="background: #fee2e2; padding: 16px; border-radius: 8px;">
              <div style="font-size: 28px; font-weight: 700; color: #dc2626;">${skipped}</div>
              <div style="font-size: 13px; color: #dc2626;">Skipped (Duplicates)</div>
            </div>
          </div>
      `;
      
      if (added > 0) {
        html += `<p style="color: #059669; margin-bottom: 16px;">‚úÖ Successfully added ${added} new ${type.toLowerCase()}!</p>`;
      }
      
      if (skipped > 0) {
        html += `<p style="color: #666; margin-bottom: 16px;">‚ÑπÔ∏è ${skipped} duplicates were skipped</p>`;
      }
      
      if (errors.length > 0) {
        html += `<p style="color: #dc2626; margin-bottom: 8px;">‚ö†Ô∏è ${errors.length} errors</p>`;
        html += `<details style="text-align: left; font-size: 12px;"><summary>View errors</summary><pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 8px; overflow: auto; max-height: 100px;">${errors.join('\n')}</pre></details>`;
      }
      
      html += '</div>';
      document.getElementById('bulkUploadResults').innerHTML = html;
      document.getElementById('bulkUploadModal').classList.remove('hidden');
    }

    // Single Add Functions
    function showAddSingleParticipant() {
      document.getElementById('newPartName').value = '';
      document.getElementById('newPartEmail').value = '';
      document.getElementById('newPartDesignation').value = '';
      document.getElementById('newPartOrg').value = '';
      document.getElementById('newPartPhone').value = '';
      document.getElementById('newPartSports').value = '';
      document.getElementById('addParticipantModal').classList.remove('hidden');
    }

    function saveSingleParticipant() {
      const name = document.getElementById('newPartName').value.trim();
      const email = document.getElementById('newPartEmail').value.trim();
      const designation = document.getElementById('newPartDesignation').value.trim();
      const org = document.getElementById('newPartOrg').value.trim();
      const phone = document.getElementById('newPartPhone').value.trim();
      const sportsStr = document.getElementById('newPartSports').value.trim();
      const sportsList = sportsStr.split(',').map(s => s.trim()).filter(s => s);
      
      if (!name || !email) {
        alert('Name and Email are required');
        return;
      }
      
      if (participants.find(p => p.email === email)) {
        alert('A participant with this email already exists');
        return;
      }
      
      participants.push({
        id: 'P-' + String(participants.length + 1).padStart(4, '0'),
        name,
        designation,
        organization: org,
        phone,
        email,
        sports: sportsList
      });
      
      saveData();
      closeModal('addParticipantModal');
      renderParticipants();
      updateDashboard();
      populateFilters();
    }

    function showAddSingleVip() {
      document.getElementById('newVipName').value = '';
      document.getElementById('newVipRanking').value = '';
      document.getElementById('newVipDesignation').value = '';
      document.getElementById('newVipOrg').value = '';
      document.getElementById('newVipBudget').value = '5';
      document.getElementById('newVipPhone').value = '';
      document.getElementById('addVipModal').classList.remove('hidden');
    }

    function saveSingleVip() {
      const name = document.getElementById('newVipName').value.trim();
      const ranking = parseInt(document.getElementById('newVipRanking').value);
      const designation = document.getElementById('newVipDesignation').value.trim();
      const org = document.getElementById('newVipOrg').value.trim();
      const budget = parseInt(document.getElementById('newVipBudget').value) || 5;
      const phone = document.getElementById('newVipPhone').value.trim();
      
      if (!name || !ranking) {
        alert('Name and Ranking are required');
        return;
      }
      
      if (ranking < 1 || ranking > 10) {
        alert('Ranking must be between 1 and 10');
        return;
      }
      
      if (vips.find(v => v.ranking === ranking)) {
        alert('A VIP with this ranking already exists');
        return;
      }
      
      vips.push({
        id: 'V-' + String(vips.length + 1).padStart(3, '0'),
        name,
        designation,
        organization: org,
        ranking,
        status: 'Active',
        shields_given: 0,
        shield_budget: budget
      });
      
      saveData();
      closeModal('addVipModal');
      renderVip();
      updateDashboard();
    }
  </script>
</body>
</html>
